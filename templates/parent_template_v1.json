{"flow":{"onboarding":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"489530e0-f921-48c1-82d3-0a89219e070e","type":"text/plain","content":"User input"},"editable":false,"deletable":false,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"7446e4ac-c000-4a55-968e-d504af79e80e","conditions":[{"source":"input","comparison":"matches","values":[".*"]}],"$id":"93708261-023c-421f-a884-3446fc73a290","$connId":"con_3","$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"c879c625-2b16-49dc-ab5a-7cf78fc0d000","$typeOfContent":"","type":"SetVariable","$title":"SET service","$invalid":false,"settings":{"variable":"service","value":"Parent Flow"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-9ae8b976-a0dd-45f6-9dae-26562b5c0e18","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-3b61efa6-0967-4362-9d61-1ba337824470","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"onboarding","root":true,"$title":"Start","$position":{"top":"344.859px","left":"2624px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fallback":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"656443dd-50cd-41be-a11c-451a9b4ad209","type":"text/plain","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"subflow:0ed7556a-b977-476c-ab4c-3412b3057f47","typeOfStateId":"state","$connId":"con_8","$id":"20e1b01a-febf-40fa-9e12-b8b79c7788a6","conditions":[{"source":"input","comparison":"notExists","values":[]}],"$invalid":false},{"stateId":"subflow:dc478d43-d47b-4237-9fe1-a044532c4bf2","typeOfStateId":"state","$connId":"con_13","$id":"ae28b29a-b277-4757-8cd4-a423077916e0","conditions":[{"source":"context","comparison":"notEquals","values":["default"],"variable":"apiError@id"}],"$invalid":false},{"stateId":"subflow:e8652e14-7b31-4903-84ce-ee8fefe25d2b","conditions":[{"source":"input","comparison":"matches","values":[".*"],"variable":"discardMultipleMessage"}],"$id":"532e483d-704e-4311-a1e3-be320a29c6cc","$connId":"con_18","$invalid":false}],"$enteringCustomActions":[{"$id":"fcf577f1-a74d-433d-b3ea-2944a9321133","$typeOfContent":"","type":"ExecuteScript","$title":"SET origin","$invalid":false,"settings":{"function":"run","source":"function run(redirect, statePreviousName) {\n\tconst DEFAULT_ORIGIN =  `Parent Flow | ${statePreviousName}`;\n\n\ttry {\n\t\tif (redirect) {\n\t\t\tredirect = JSON.parse(redirect);\n\t\t\treturn `${redirect.from.service} | ${redirect.from.stateName}`\n\t\t}\n\n\t\treturn DEFAULT_ORIGIN;\n\t}\n\tcatch(e) {\n\t\treturn DEFAULT_ORIGIN;\n\t}\n}","inputVariables":["redirect","state.previous.name"],"outputVariable":"origin","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"64391e04-b74e-4445-9bcd-d25a3c02306b","$typeOfContent":"","type":"TrackEvent","$title":"Inactivity origem","$invalid":false,"settings":{"extras":{},"category":"Inactivity origem","action":"{{origin}}"},"conditions":[{"values":[],"source":"input","comparison":"notExists"}]},{"$id":"a7776974-d1da-449d-b8bd-1d322c2630df","$typeOfContent":"","type":"TrackEvent","$title":"Api error origem","$invalid":false,"settings":{"extras":{},"category":"Api error origem","action":"{{origin}}"},"conditions":[{"values":[],"source":"input","comparison":"exists"},{"values":["default"],"source":"context","comparison":"notEquals","variable":"apiError@id"}]},{"$id":"5cc83915-2170-496c-a69d-8e4f513223a2","$typeOfContent":"","type":"TrackEvent","$title":"Exception origem","$invalid":false,"settings":{"extras":{},"category":"Exception origem","action":"{{origin}}"},"conditions":[{"values":[],"source":"input","comparison":"exists"},{"values":["default"],"source":"context","comparison":"equals","variable":"apiError@id"}]}],"$leavingCustomActions":[{"$id":"bbb04708-e510-4ac7-9203-950e8e4d57c1","$typeOfContent":"","type":"SetVariable","$title":"RESET origin","$invalid":false,"settings":{"variable":"origin"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-03d1f64a-3742-487f-886e-79892747a3c2","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-0245f358-e1db-4bcc-9c1d-dc55f929f9d4","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-8fc4274f-69f0-48be-b972-6279d22a7099","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"fallback","$title":"Exceptions","$position":{"top":"345px","left":"3786.54px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"error":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"8bc01586-8ac5-4f7d-8154-0eab828cda11","type":"text/plain","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"705c309a-3494-4167-8f18-0a93d47d2247","$typeOfContent":"","type":"ExecuteScript","$title":"SET subflow (disable)","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nfunction run(stateId, stateName) {\n\treturn disableSubflowMode(stateId, stateName);\n}","inputVariables":["state.id","state.name"],"outputVariable":"subflow","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"{{redirect@to.stateId}}","$invalid":false,"typeOfStateId":"variable"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-26f612ab-b253-4870-bb57-57234785b407","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"error","$title":"Return to last menu or Redirect","$position":{"top":"768.5px","left":"3786.5px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"subflow:e8652e14-7b31-4903-84ce-ee8fefe25d2b":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"427a7302-edb9-4fe9-83bf-a07e6e7f27c7","type":"text/plain","textContent":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"error","typeOfStateId":"state","$connId":"con_23","$id":"71be1fdf-8151-4256-b231-2d4b868b34d4","conditions":[{"source":"input","comparison":"exists","values":[],"variable":"subflow@isActive"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"cf8fc7c3-8977-4f26-ae9b-43644a72e5c5","$typeOfContent":"","type":"TrackEvent","$title":"TrackEvent","settings":{"category":"subflow:e8652e14-7b31-4903-84ce-ee8fefe25d2b","action":"Entering subflow - subflow:e8652e14-7b31-4903-84ce-ee8fefe25d2b","subflowDefaultAction":true},"$invalid":false},{"$id":"823f5a0d-a79a-4888-8445-3ca400effbe3","$typeOfContent":"","type":"MergeContact","$title":"MergeContact","settings":{"extras":{"subflowId":"subflow:e8652e14-7b31-4903-84ce-ee8fefe25d2b"},"subflowDefaultAction":true},"$invalid":false},{"$id":"9b2ce488-07cd-43c8-9a2a-952a1be65168","$typeOfContent":"","type":"ExecuteScript","$title":"SET exceptionMessage","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nfunction run(\n\tsubflow, \n\tlastStateWithInput, \n\tlastSubflowStateWithInput\n) {\n\tconst origin = setOrigin({\n\t\tservice: 'Cascade',\n\t\tstateId: '{{state.id}}',\n\t\tstateName: '{{state.name}}'\n\t});\n\n\t// Handle input exception  inside a subflow\n\tif (subflow) {\n\t\tsubflow = JSON.parse(subflow);\n\n\t\tif (subflow.isActive) {\n\t\t\tlastSubflowStateWithInput = JSON.parse(lastSubflowStateWithInput);\n\n\t\t\tconst destination = setDestination({\n\t\t\t\tstateId: subflow.id,\n\t\t\t\tstateName:  subflow.name,\n\t\t\t\tsubflowStateName: lastSubflowStateWithInput.name,\n\t\t\t\tsubflowStateId: lastSubflowStateWithInput.id\n\t\t\t});\n\n\t\t\treturn redirect(origin, destination, { skipCallerMessageSave: true }); \n\t\t}\n\t}\n\n\t// Handle input exception on parent flow\n\tlastStateWithInput = JSON.parse(lastStateWithInput);\n\n\tconst destination = setDestination({\n\t\tservice: 'Parent Flow',\n\t\tstateId: lastStateWithInput.id\n\t});\n\n\treturn redirect(origin, destination);\n}","inputVariables":["subflow","lastStateWithInput","lastSubflowStateWithInput"],"outputVariable":"exceptionMessage","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"fe74fb34-640e-4def-af51-524ad88fa8f3","$typeOfContent":"","type":"SetVariable","$title":"SET onCascadeHandling = true","$invalid":false,"settings":{"variable":"onCascadeHandling","value":"true"},"conditions":[]},{"$id":"12132b40-c2ed-4457-8de8-18bed87e1ff8","$typeOfContent":"","type":"SetVariable","$title":"SET message","$invalid":false,"settings":{"variable":"message","value":"{{redirect}}"},"conditions":[]},{"$id":"18ba06fb-dcc4-4d31-b271-aa17185f1564","$typeOfContent":"","type":"SetVariable","$title":"RESET redirect","$invalid":false,"settings":{"variable":"redirect","value":"default"},"conditions":[]}],"$leavingCustomActions":[{"$id":"21379887-97b8-42da-a138-392760331597","$typeOfContent":"","type":"SetVariable","$title":"SET onCascadeHandling = false","$invalid":false,"settings":{"variable":"onCascadeHandling","value":"false"},"conditions":[]},{"$id":"83ba57d0-9283-468b-8878-3d399910ba39","$typeOfContent":"","type":"SetVariable","$title":"RESET message","$invalid":false,"settings":{"variable":"message"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-7198aa7e-e2ea-43a8-9ba3-b39ce6937010","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-bee69324-56cd-4e5d-b668-c0134e52004c","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-0caab4d3-5723-4ed0-9dff-f5ae7d6e2ec5","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-18810cfe-4d59-4e5f-819a-4363a6dd8e1c","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-d3a1403d-f08d-4565-9701-d3af1d65260c","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"subflow:e8652e14-7b31-4903-84ce-ee8fefe25d2b","root":false,"shortNameOfSubflow":"inputhandler4","$imageUri":"https://blipmediastore.blip.ai/public-medias/Media_7f891c19-0211-469f-9fd2-2fe8ad41035d","$title":"Input Handler","$position":{"top":"513.5px","left":"3761.5px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"subflow:dc478d43-d47b-4237-9fe1-a044532c4bf2":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"25caec9f-d379-4974-8ccd-49483f1bd776","type":"text/plain","textContent":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"error","typeOfStateId":"state","$connId":"con_28","$id":"c0de757f-b797-42a4-b960-9ebd03971c74","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"2c8b88f4-6bfb-4784-9b16-a9941260e5ef","$typeOfContent":"","type":"TrackEvent","$title":"TrackEvent","settings":{"category":"subflow:dc478d43-d47b-4237-9fe1-a044532c4bf2","action":"Entering subflow - subflow:dc478d43-d47b-4237-9fe1-a044532c4bf2","subflowDefaultAction":true},"$invalid":false},{"$id":"74e59008-f3e5-48a6-805b-c43c18792b8b","$typeOfContent":"","type":"MergeContact","$title":"MergeContact","settings":{"extras":{"subflowId":"subflow:dc478d43-d47b-4237-9fe1-a044532c4bf2"},"subflowDefaultAction":true},"$invalid":false},{"$id":"27851fee-d11c-4653-b904-93ac0feb0211","$typeOfContent":"","type":"SetVariable","$title":"SET message","$invalid":false,"settings":{"variable":"message","value":"{{redirect}}"},"conditions":[]},{"$id":"3ae06673-3b8d-47c6-9737-b8dc0f99a56d","$typeOfContent":"","type":"SetVariable","$title":"RESET redirect","$invalid":false,"settings":{"variable":"redirect","value":"default"},"conditions":[]}],"$leavingCustomActions":[{"$id":"fbb92754-d508-411f-b2bb-9ee599ad6f47","$typeOfContent":"","type":"SetVariable","$title":"RESET message","$invalid":false,"settings":{"variable":"message"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-8999242c-d90b-4c8e-a856-fc3a815ede16","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-2e7cdef5-61b5-4b49-97c2-e9dc01d6e7ee","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-52730790-6935-48c4-b2b7-9a6a95b6182e","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-9569d427-cb40-4c20-8302-55e51ab06c5e","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"subflow:dc478d43-d47b-4237-9fe1-a044532c4bf2","root":false,"shortNameOfSubflow":"apierrorhandler4","$imageUri":"","$title":"API Error Handler","$position":{"top":"516.5px","left":"4080.5px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"subflow:29f820b7-df92-4461-9987-46f0acaefc5b":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"a39b1c62-4668-446b-b1fc-1505fa39f19a","type":"text/plain","textContent":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"{{redirect@to.stateId}}","typeOfStateId":"variable","$id":"31af9e43-1bd0-4256-822e-d152717f079b","conditions":[{"source":"context","comparison":"exists","values":[],"variable":"redirect@to.stateId"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"6e3c3005-16c3-40c9-91ed-bee32027f0cc","$typeOfContent":"","type":"TrackEvent","$title":"TrackEvent","settings":{"category":"subflow:29f820b7-df92-4461-9987-46f0acaefc5b","action":"Entering subflow - subflow:29f820b7-df92-4461-9987-46f0acaefc5b","subflowDefaultAction":true},"$invalid":false},{"$id":"936933d2-5b62-4c39-8cd6-3f95dd6557a5","$typeOfContent":"","type":"MergeContact","$title":"MergeContact","settings":{"extras":{"subflowId":"subflow:29f820b7-df92-4461-9987-46f0acaefc5b"},"subflowDefaultAction":true},"$invalid":false},{"$id":"b5118a50-0cfc-4977-8556-d36e563f4370","$typeOfContent":"","type":"ExecuteScript","$title":"SET subflow (enable)","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nfunction run(stateId, stateName) {\n\treturn enableSubflowMode(stateId, stateName);\n}","inputVariables":["state.id","state.name"],"outputVariable":"subflow","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"e392a959-28ff-4005-ac7f-829997fbb612","$typeOfContent":"","type":"ExecuteScript","$title":"SET origin","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nfunction run(redirect, statePreviousName) {\n\treturn getOrigin(redirect, statePreviousName);\n}","inputVariables":["redirect","state.previous.name"],"outputVariable":"origin","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5246f03e-6c29-4501-8a07-fd7ac4974bde","$typeOfContent":"","type":"SetVariable","$title":"SET message","$invalid":false,"settings":{"variable":"message","value":"{{redirect}}"},"conditions":[]},{"$id":"9f273ae4-173c-41c9-8f43-67fba9cab3c8","$typeOfContent":"","type":"SetVariable","$title":"RESET redirect","$invalid":false,"settings":{"variable":"redirect","value":"default"},"conditions":[]}],"$leavingCustomActions":[{"$id":"77c85c90-0d03-4c17-b778-94ab78d10151","$typeOfContent":"","type":"SetVariable","$title":"RESET message","$invalid":false,"settings":{"variable":"message"},"conditions":[]},{"$id":"e6c848b2-1c87-4e3c-950d-6dbce56051f0","$typeOfContent":"","type":"SetVariable","$title":"RESET origin","$invalid":false,"settings":{"variable":"origin"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-52b7662a-614f-419f-a984-ebee76828a31","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-db0a5112-56c2-4464-9491-010e255e41d1","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-97070a5b-2914-44cd-9e3b-6bf1caf01fe0","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-4f13af1a-0f10-4097-a7b8-64f0e14d45b9","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-f47a34c6-1607-4e92-abb5-df99e9a519f3","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"subflow:29f820b7-df92-4461-9987-46f0acaefc5b","root":false,"shortNameOfSubflow":"finalization4","$imageUri":"","$title":"Finalization","$position":{"top":"1189.63px","left":"3754px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"subflow:6588850e-97a3-4619-b2b7-5e7f6e9ee29c":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"23c864df-7d85-4249-a7e1-62cfd5d824e7","type":"text/plain","textContent":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"{{redirect@to.stateId}}","typeOfStateId":"variable","$id":"e553450c-8dae-4fec-ad52-5a6a451d3a8f","conditions":[{"source":"context","comparison":"exists","values":[],"variable":"redirect@to.stateId"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"9d1e80cf-cf36-4f9f-8139-1673f6c16af6","$typeOfContent":"","type":"TrackEvent","$title":"TrackEvent","settings":{"category":"subflow:6588850e-97a3-4619-b2b7-5e7f6e9ee29c","action":"Entering subflow - subflow:6588850e-97a3-4619-b2b7-5e7f6e9ee29c","subflowDefaultAction":true},"$invalid":false},{"$id":"62bda319-4eab-4866-ab0f-fab0c454ff7b","$typeOfContent":"","type":"MergeContact","$title":"MergeContact","settings":{"extras":{"subflowId":"subflow:6588850e-97a3-4619-b2b7-5e7f6e9ee29c"},"subflowDefaultAction":true},"$invalid":false},{"$id":"67a4f7db-e720-4c23-8b1c-e3696c10f6a7","$typeOfContent":"","type":"ExecuteScript","$title":"SET subflow (enable)","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nfunction run(stateId, stateName) {\n\treturn enableSubflowMode(stateId, stateName);\n}","inputVariables":["state.id","state.name"],"outputVariable":"subflow","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"549961c3-7fec-41ab-bde7-de6c25583e1d","$typeOfContent":"","type":"ExecuteScript","$title":"SET origin","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nfunction run(redirect, statePreviousName) {\n\treturn getOrigin(redirect, statePreviousName);\n}","inputVariables":["redirect","state.previous.name"],"outputVariable":"origin","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"13f7e024-0882-4d1f-9251-47b2308afb7c","$typeOfContent":"","type":"SetVariable","$title":"SET message","$invalid":false,"settings":{"variable":"message","value":"{{redirect}}"},"conditions":[]},{"$id":"75a70ed2-6fe0-46b5-82c5-4c0d8685f7e9","$typeOfContent":"","type":"SetVariable","$title":"RESET redirect","$invalid":false,"settings":{"variable":"redirect","value":"default"},"conditions":[]}],"$leavingCustomActions":[{"$id":"3abf8407-08d9-4936-8a8f-a2931382b728","$typeOfContent":"","type":"SetVariable","$title":"RESET message","$invalid":false,"settings":{"variable":"message"},"conditions":[]},{"$id":"c7b42b22-7028-4cff-ab42-9365457683b0","$typeOfContent":"","type":"SetVariable","$title":"RESET origin","$invalid":false,"settings":{"variable":"origin"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-2491b7ce-971c-4165-9e58-1b3f2279214a","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-1d92a736-cb61-43d6-864d-2ed4edcdb845","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-8c7760b7-7f75-4aa4-8b46-86aa56ea6ae3","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-b03702a5-9314-42ff-aa9d-480156755c28","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-2d19853b-e3c2-4c6b-a2e8-9f6ebc5db486","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"subflow:6588850e-97a3-4619-b2b7-5e7f6e9ee29c","root":false,"shortNameOfSubflow":"desk6","$imageUri":"https://blipmediastore.blip.ai/public-medias/Media_b13ed154-2d3e-4eb8-9c09-813f1c392d1c","$title":"Desk","$position":{"top":"1418px","left":"3754px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7446e4ac-c000-4a55-968e-d504af79e80e":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"c8af1115-7516-49f3-8cce-bf1897a24727","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"subflow:9f0f74c3-5b50-46ba-af50-7fcd3a3f1181","typeOfStateId":"state","$connId":"con_33","$id":"5b3b5535-db18-4890-a89a-63059e2ab43b","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"f3e2d753-d346-416a-a5ef-53e6ed653395","$typeOfContent":"","type":"ExecuteScript","$title":"SET entrypoint","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nfunction run(input, entrypoints) {\n\treturn verifyEntrypoints(input, entrypoints);\n}","inputVariables":["input.content","entrypoints"],"outputVariable":"entrypoint","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"60d22183-ee11-446c-963c-6ec3819cb882","$typeOfContent":"","type":"ExecuteScript","$title":"UPDATE session","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nfunction run(session, entrypoint, inputContent) {\n\ttry {\n\t\tconst origin = 'Principal';\n\n\t\treturn updateSession(\n\t\t\tsession, \n\t\t\tentrypoint, \n\t\t\tinputContent,\n\t\t\torigin\n\t\t);\n\t} catch(e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["session","entrypoint","input.content"],"outputVariable":"session","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"subflow:9f0f74c3-5b50-46ba-af50-7fcd3a3f1181","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-cb3c88cc-14f4-47cb-950f-1ae466152ce8","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"7446e4ac-c000-4a55-968e-d504af79e80e","root":false,"$title":"Verify entrypoints and save session","$position":{"top":"493px","left":"2624px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true},"subflow:50d68e92-815c-4421-b0a8-236d31f52afb":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"d5a59cc7-9908-4521-a319-a1d1c6b63dc9","type":"text/plain","textContent":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"{{redirect@to.stateId}}","typeOfStateId":"variable","$id":"57edacf7-4581-42a9-911e-d0b2a5093e36","conditions":[{"source":"context","comparison":"exists","values":[],"variable":"redirect@to.stateId"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"4786f5f5-bb95-4c78-9b5f-69734ae692d6","$typeOfContent":"","type":"TrackEvent","$title":"TrackEvent","settings":{"category":"subflow:50d68e92-815c-4421-b0a8-236d31f52afb","action":"Entering subflow - subflow:50d68e92-815c-4421-b0a8-236d31f52afb","subflowDefaultAction":true},"$invalid":false},{"$id":"acc35fe8-f444-450f-a587-2415825611a9","$typeOfContent":"","type":"MergeContact","$title":"MergeContact","settings":{"extras":{"subflowId":"subflow:50d68e92-815c-4421-b0a8-236d31f52afb"},"subflowDefaultAction":true},"$invalid":false},{"$id":"e9fba353-8351-45de-904a-05dd624a7040","$typeOfContent":"","type":"ExecuteScript","$title":"SET subflow (enable)","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nfunction run(stateId, stateName) {\n\treturn enableSubflowMode(stateId, stateName);\n}","inputVariables":["state.id","state.name"],"outputVariable":"subflow","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"37f20519-a3e6-4dcf-9ebe-85ae9fd02fed","$typeOfContent":"","type":"ExecuteScript","$title":"SET origin","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nfunction run(redirect, statePreviousName) {\n\treturn getOrigin(redirect, statePreviousName);\n}","inputVariables":["redirect","state.previous.name"],"outputVariable":"origin","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"c831417a-0cbb-4638-a854-44adf3caa726","$typeOfContent":"","type":"SetVariable","$title":"SET message","$invalid":false,"settings":{"variable":"message","value":"{{redirect}}"},"conditions":[]},{"$id":"96a1ee7b-128f-46e0-bb93-387e35a1f93f","$typeOfContent":"","type":"SetVariable","$title":"RESET redirect","$invalid":false,"settings":{"variable":"redirect","value":"default"},"conditions":[]}],"$leavingCustomActions":[{"$id":"7e38ffe5-b5d9-4183-80e7-baba5e7b5719","$typeOfContent":"","type":"SetVariable","$title":"RESET message","$invalid":false,"settings":{"variable":"message"},"conditions":[]},{"$id":"3bc69957-ec0f-4cab-a339-88c3a7788edc","$typeOfContent":"","type":"SetVariable","$title":"RESET origin","$invalid":false,"settings":{"variable":"origin"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-bf66bd94-8ac5-4c2f-a113-d00e38ebb2ac","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-18702a17-9a19-4c80-9012-1b95d25d817a","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-178af127-0474-4ea2-911b-2ae2431ce3b2","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-00947b39-86be-422a-968e-c78e64232217","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-13104e5a-3e72-4bdf-b701-d76f8b1349de","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"subflow:50d68e92-815c-4421-b0a8-236d31f52afb","root":false,"shortNameOfSubflow":"entrypoints5","$imageUri":"https://blipmediastore.blip.ai/public-medias/Media_714a50b3-1f78-4a9a-bde1-2c179baa391d","$title":"Entrypoints","$position":{"top":"1654px","left":"3755px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"subflow:0ed7556a-b977-476c-ab4c-3412b3057f47":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"4e9d6a6a-e377-4088-b226-0fddab076927","type":"text/plain","textContent":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"error","typeOfStateId":"state","$connId":"con_38","$id":"16192eb9-91ac-48d5-9f5a-c55549870696","conditions":[{"source":"context","comparison":"equals","values":["false"],"variable":"subflow@isActive"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"da78d92b-2648-4fed-a285-6a2020a049f2","$typeOfContent":"","type":"TrackEvent","$title":"TrackEvent","settings":{"category":"subflow:0ed7556a-b977-476c-ab4c-3412b3057f47","action":"Entering subflow - subflow:0ed7556a-b977-476c-ab4c-3412b3057f47","subflowDefaultAction":true},"$invalid":false},{"$id":"b0f99591-78d2-45bd-9929-7b64e96fa7fc","$typeOfContent":"","type":"MergeContact","$title":"MergeContact","settings":{"extras":{"subflowId":"subflow:0ed7556a-b977-476c-ab4c-3412b3057f47"},"subflowDefaultAction":true},"$invalid":false},{"$id":"096ddb59-e42d-4a4f-9694-edd3764ce8c6","$typeOfContent":"","type":"ExecuteScript","$title":"SET inactivityMessage (Don't change the order)","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nfunction run(\n\tsubflow, \n\tlastStateWithInput, \n\tlastSubflowStateWithInput\n) {\n\tconst origin = setOrigin({\n\t\tservice: 'Inactivity',\n\t\tstateId: '{{state.id}}',\n\t\tstateName: '{{state.name}}'\n\t});\n\n\t// Handle inactivity inside a subflow\n\tif (subflow) {\n\t\tsubflow = JSON.parse(subflow);\n\n\t\tif (subflow.isActive) {\n\t\t\tlastSubflowStateWithInput = JSON.parse(lastSubflowStateWithInput);\n\n\t\t\tconst destination = setDestination({\n\t\t\t\tstateId: subflow.id,\n\t\t\t\tstateName:  subflow.name,\n\t\t\t\tsubflowStateName: lastSubflowStateWithInput.name,\n\t\t\t\tsubflowStateId: lastSubflowStateWithInput.id\n\t\t\t});\n\n\t\t\treturn redirect(origin, destination, { skipCallerMessageSave: true }); \n\t\t}\n\t}\n\n\t// Handle inactivity on parent flow\n\tlastStateWithInput = JSON.parse(lastStateWithInput);\n\t\n\tconst destination = setDestination({\n\t\tservice: 'Parent Flow',\n\t\tstateName: lastStateWithInput.name,\n\t\tstateId: lastStateWithInput.id\n\t});\n\n\treturn redirect(origin, destination);\n}","inputVariables":["subflow","lastStateWithInput","lastSubflowStateWithInput"],"outputVariable":"inactivityMessage","LocalTimeZoneEnabled":false},"conditions":[{"values":[],"source":"input","comparison":"notExists"}]},{"$id":"7f808db1-a4bc-43e5-ab96-0a0c4e6ededf","$typeOfContent":"","type":"ExecuteScript","$title":"SET subflow (enable)","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\r\n\r\nfunction run(stateId, stateName) {\r\n\treturn enableSubflowMode(stateId, stateName);\r\n}","inputVariables":["state.id","state.name"],"outputVariable":"subflow","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"71b7d452-b570-458c-a706-e1b11a984975","$typeOfContent":"","type":"SetVariable","$title":"SET message","$invalid":false,"settings":{"variable":"message","value":"{{redirect}}"},"conditions":[]},{"$id":"4d8c6e61-0e07-4bbe-bbd6-9829f7201432","$typeOfContent":"","type":"SetVariable","$title":"RESET redirect","$invalid":false,"settings":{"variable":"redirect","value":"default"},"conditions":[]}],"$leavingCustomActions":[{"$id":"2c029318-e2eb-4b4a-b7bf-27931d2324fc","$typeOfContent":"","type":"SetVariable","$title":"RESET message","$invalid":false,"settings":{"variable":"message"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-078085dc-8c82-4363-bd86-0e68dfa754db","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-16d8878d-5f41-42ae-aebf-961ec2b88280","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-ca116e6d-5593-4db9-8235-9bd70a4cdffc","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-743f5309-d6c6-404f-8a28-2f8f1139911f","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-3d9c391b-6219-4e70-a34f-113365c96678","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"subflow:0ed7556a-b977-476c-ab4c-3412b3057f47","root":false,"shortNameOfSubflow":"inactivityhandler5","$imageUri":"","$title":"Inactivity Handler","$position":{"top":"516.5px","left":"3448.5px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7f2feee4-c5b0-4d7c-b77a-91f6ce6a771b":{"$contentActions":[{"action":{"$id":"8b1386da-2a45-4815-81e4-18a742136d1e","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"6e010aef-0d2d-40ba-a98a-b82d2f872841","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"6e010aef-0d2d-40ba-a98a-b82d2f872841","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"ac75a2d9-39fc-4110-9d0d-56ad5c2fdffb","$typeOfContent":"text","type":"SendMessage","settings":{"id":"5763c37a-80a9-4866-9784-fef8863bb6e9","type":"text/plain","content":"We had an internal error. Please try again later.","metadata":{}},"$cardContent":{"document":{"id":"5763c37a-80a9-4866-9784-fef8863bb6e9","type":"text/plain","content":"We had an internal error. Please try again later."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"1c68c4b9-bc0b-4259-ab08-4136c48e6820","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-eacbd65e-3ba2-4331-b365-7027d1b4627f","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"7f2feee4-c5b0-4d7c-b77a-91f6ce6a771b","root":false,"$title":"Redirect Error","$position":{"top":"351.5px","left":"4103.5px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"subflow:1d273c53-0ffd-4882-897b-3686ba8a0ca5":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"37826116-7943-4589-ac4a-87288398cb78","type":"text/plain","textContent":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"{{redirect@to.stateId}}","typeOfStateId":"variable","$id":"2de174d6-ece3-4ae7-8bdd-2d5bc4b1754a","conditions":[{"source":"context","comparison":"exists","values":[],"variable":"redirect@to.stateId"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"cfca849d-6092-4dd5-b958-5df0efaefd54","$typeOfContent":"","type":"TrackEvent","$title":"TrackEvent","settings":{"category":"subflow:1d273c53-0ffd-4882-897b-3686ba8a0ca5","action":"Entering subflow - subflow:1d273c53-0ffd-4882-897b-3686ba8a0ca5","subflowDefaultAction":true},"$invalid":false},{"$id":"ad102e47-7d3f-4312-8682-b209619b55bb","$typeOfContent":"","type":"MergeContact","$title":"MergeContact","settings":{"extras":{"subflowId":"subflow:1d273c53-0ffd-4882-897b-3686ba8a0ca5"},"subflowDefaultAction":true},"$invalid":false},{"$id":"943570cd-9faf-4311-a3a7-e2d1fd5bc807","$typeOfContent":"","type":"ExecuteScript","$title":"SET subflow (enable)","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nfunction run(stateId, stateName) {\n\treturn enableSubflowMode(stateId, stateName);\n}","inputVariables":["state.id","state.name"],"outputVariable":"subflow","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"40715ead-5822-4b50-aa27-d5f919315ad5","$typeOfContent":"","type":"ExecuteScript","$title":"SET origin","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nfunction run(redirect, statePreviousName) {\n\treturn getOrigin(redirect, statePreviousName);\n}","inputVariables":["redirect","state.previous.name"],"outputVariable":"origin","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"6ad0326c-6394-44c8-a84f-aec929b1ab29","$typeOfContent":"","type":"SetVariable","$title":"SET message","$invalid":false,"settings":{"variable":"message","value":"{{redirect}}"},"conditions":[]},{"$id":"8e6c9e5e-0d7e-48cf-b22e-9c08e9ef5ef3","$typeOfContent":"","type":"SetVariable","$title":"RESET redirect","$invalid":false,"settings":{"variable":"redirect","value":"default"},"conditions":[]}],"$leavingCustomActions":[{"$id":"ee28d32a-291c-42e5-8bef-aed305c1c4c5","$typeOfContent":"","type":"SetVariable","$title":"RESET message","$invalid":false,"settings":{"variable":"message"},"conditions":[]},{"$id":"f9aa4fc2-a095-41ed-91cc-405c2fd22d0c","$typeOfContent":"","type":"SetVariable","$title":"RESET origin","$invalid":false,"settings":{"variable":"origin"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-e6af21eb-ab46-445b-969c-bddda0ffe50d","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-a75b7815-d87a-47c4-87e2-49431e13f403","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-920a67d1-f5cb-445e-b7e3-51424a1b891f","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-5a6bf8bd-d181-4da4-95a1-202e9ceeb5cf","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-5578fdcd-d0e1-4280-8000-f8b00027864d","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"subflow:1d273c53-0ffd-4882-897b-3686ba8a0ca5","root":false,"shortNameOfSubflow":"prefinalization1","$imageUri":"","$title":"Pre Finalization","$position":{"top":"960.563px","left":"3752.96px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"subflow:9f0f74c3-5b50-46ba-af50-7fcd3a3f1181":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"77cf1bbe-7071-48bb-b93f-d774c16431cc","type":"text/plain","textContent":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"{{redirect@to.stateId}}","typeOfStateId":"variable","$id":"7f103d45-fd49-4431-b22d-21bbb1a32743","conditions":[{"source":"context","comparison":"exists","values":[],"variable":"redirect@to.stateId"}],"$invalid":false},{"stateId":"{{subflowIds@Entrypoints}}","typeOfStateId":"variable","$id":"6b4fede5-1b61-47ec-8d41-081d0059aa6c","conditions":[{"source":"context","comparison":"equals","values":["Sim"],"variable":"entrypoint@matched"}],"$invalid":false},{"stateId":"subflow:76ebc8e8-e46e-4661-a013-172a130d5b22","typeOfStateId":"state","$connId":"con_43","$id":"f0b04069-a1e2-44b9-bbf7-3536bc10e89a","conditions":[{"source":"context","comparison":"equals","values":["false"],"variable":"subflow@isActive"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"8d1e7d89-baff-497b-81d3-4980d0570b4a","$typeOfContent":"","type":"TrackEvent","$title":"TrackEvent","settings":{"category":"subflow:9f0f74c3-5b50-46ba-af50-7fcd3a3f1181","action":"Entering subflow - subflow:9f0f74c3-5b50-46ba-af50-7fcd3a3f1181","subflowDefaultAction":true},"$invalid":false},{"$id":"cd4337b7-e0ba-4143-a230-d1b4dfe841ac","$typeOfContent":"","type":"MergeContact","$title":"MergeContact","settings":{"extras":{"subflowId":"subflow:9f0f74c3-5b50-46ba-af50-7fcd3a3f1181"},"subflowDefaultAction":true},"$invalid":false},{"$id":"b27eb0b2-a5c3-4da7-acec-4df5ec9b4480","$typeOfContent":"","type":"ExecuteScript","$title":"SET subflow (enable)","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nfunction run(stateId, stateName) {\n\treturn enableSubflowMode(stateId, stateName);\n}","inputVariables":["state.id","state.name"],"outputVariable":"subflow","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"b67ad16e-2d0f-4731-a2f9-93104e34b358","$typeOfContent":"","type":"ExecuteScript","$title":"SET origin","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nfunction run(redirect, statePreviousName) {\n\treturn getOrigin(redirect, statePreviousName);\n}","inputVariables":["redirect","state.previous.name"],"outputVariable":"origin","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"77634b3d-cbd2-427a-adb9-78b1d4662032","$typeOfContent":"","type":"SetVariable","$title":"SET message","$invalid":false,"settings":{"value":"{{redirect}}","variable":"message"},"conditions":[]},{"$id":"78b12c7b-a57c-4b11-a9f9-3637b475d37a","$typeOfContent":"","type":"SetVariable","$title":"RESET redirect","$invalid":false,"settings":{"variable":"redirect","value":"default"},"conditions":[]}],"$leavingCustomActions":[{"$id":"1e0b43dd-f7c6-4d59-9755-edd16950fa04","$typeOfContent":"","type":"SetVariable","$title":"RESET message","$invalid":false,"settings":{"variable":"message"},"conditions":[]},{"$id":"87b88125-708d-474c-af63-ac12a5004e2c","$typeOfContent":"","type":"SetVariable","$title":"RESET origin","$invalid":false,"settings":{"variable":"origin"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-07ad3584-35d4-41ac-b6e5-36723e433426","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-11d432be-06de-4a79-814b-a1c15c0bfd00","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-767ad6a1-e11d-46c8-822d-32cf1f59ccf1","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-83204a99-e775-42ba-9b46-1d234a017d48","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-d1716e70-83ef-42a0-bef1-258d962f179f","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"subflow:9f0f74c3-5b50-46ba-af50-7fcd3a3f1181","root":false,"shortNameOfSubflow":"onboarding7","$imageUri":"","$title":"Onboarding","$position":{"top":"651.549px","left":"2599px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"subflow:76ebc8e8-e46e-4661-a013-172a130d5b22":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"c7579e42-0d07-44ee-a732-6094b5cdb675","type":"text/plain","textContent":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"{{redirect@to.stateId}}","typeOfStateId":"variable","$id":"8d8fbe9f-8674-43b0-b9a3-53c7567b12b0","conditions":[{"source":"context","comparison":"exists","values":[],"variable":"redirect@to.stateId"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"d970e50a-daf3-4f98-9607-5e399494f92f","$typeOfContent":"","type":"TrackEvent","$title":"TrackEvent","settings":{"category":"subflow:76ebc8e8-e46e-4661-a013-172a130d5b22","action":"Entering subflow - subflow:76ebc8e8-e46e-4661-a013-172a130d5b22","subflowDefaultAction":true},"$invalid":false},{"$id":"8fa6d816-143e-483f-9e34-fae1ab00b6a3","$typeOfContent":"","type":"MergeContact","$title":"MergeContact","settings":{"extras":{"subflowId":"subflow:76ebc8e8-e46e-4661-a013-172a130d5b22"},"subflowDefaultAction":true},"$invalid":false},{"$id":"dd2dd639-5703-4f6d-8818-d93fd224603e","$typeOfContent":"","type":"ExecuteScript","$title":"SET subflow (enable)","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nfunction run(stateId, stateName) {\n\treturn enableSubflowMode(stateId, stateName);\n}","inputVariables":["state.id","state.name"],"outputVariable":"subflow","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"243ddf54-70a4-4a47-96fb-c430ef155a00","$typeOfContent":"","type":"ExecuteScript","$title":"SET origin","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nfunction run(redirect, statePreviousName) {\n\treturn getOrigin(redirect, statePreviousName);\n}","inputVariables":["redirect","state.previous.name"],"outputVariable":"origin","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"15abc123-af43-4661-abda-a41e35abff84","$typeOfContent":"","type":"SetVariable","$title":"SET message","$invalid":false,"settings":{"value":"{{redirect}}","variable":"message"},"conditions":[]},{"$id":"39637ded-bc3b-4864-be8a-e80cd633c445","$typeOfContent":"","type":"SetVariable","$title":"RESET redirect","$invalid":false,"settings":{"variable":"redirect","value":"default"},"conditions":[]}],"$leavingCustomActions":[{"$id":"e3dec082-1cac-456b-b8a7-6ef3e612965c","$typeOfContent":"","type":"SetVariable","$title":"RESET origin","$invalid":false,"settings":{"variable":"origin"},"conditions":[]},{"$id":"84fbe15d-c9f4-4cfc-a413-bd5db7e0c1b9","$typeOfContent":"","type":"SetVariable","$title":"RESET message","$invalid":false,"settings":{"variable":"message"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-f5f0adcc-00ae-4775-a6e2-b4d2059c379b","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-097c3e13-64c6-404c-a6ac-d8ff687c0f99","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-dd728ba1-0e13-4b86-a105-1398dd116165","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-be6013a8-c05d-4e0a-a418-02c86d53037c","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-053593bf-a631-471b-bef8-a9c796b77237","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"subflow:76ebc8e8-e46e-4661-a013-172a130d5b22","root":false,"shortNameOfSubflow":"mainmenu4","$imageUri":"","$title":"Main Menu","$position":{"top":"902px","left":"2599px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}},"globalActions":{"$contentActions":[],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"ade65afc-cd65-4251-8433-2c7c86f365ea","$typeOfContent":"","type":"ExecuteScript","$title":"SET globalScripts","$invalid":false,"settings":{"function":"run","source":"function run() {\n\tconst scripts = [ \n\t\tprocessUserInput, \n\t\tenableSubflowMode,\n\t\tdisableSubflowMode,\n\t\tconvertBoolToTextFlag,\n\t\tgetFormattedDate,\n\t\tupdateSession,\n\t\tverifyEntrypoints,\n\t\tredirect,\n\t\tgetOrigin\n\t];\n\n\treturn scripts.join('\\n');\n}\n\nconst processUserInput = `\n\tconst UNEXPECTED_INPUT = 'Input inesperado';\n\tconst INACTIVITY_FLAG = 'Inatividade';\n\tconst ERROR_FLAG = 'Error';\n\t\n\tfunction processUserInput(input, optionsRegex) {\n\n\t\ttry {\n\t\t\tconst match = matchKey(optionsRegex, input);\n\n\t\t\tconst selection = optionsRegex[match] || UNEXPECTED_INPUT;\n\n\t\t\tlet tracking = INACTIVITY_FLAG;\n\t\t\tlet userInput = INACTIVITY_FLAG;\n\n\t\t\tif (input) {\n\t\t\t\t// Remove accents\n\t\t\t\ttracking = selection.normalize('NFD').replace(/[\\u0300-\\u036f]/g, \"\");\n\t\t\t\tuserInput = input;\n\t\t\t}\n\n\t\t\treturn setUserInput(userInput, selection, tracking);\n\t\t} catch (e) {\n\t\t\treturn { \n\t\t\t\t...setUserInput(input, UNEXPECTED_INPUT, ERROR_FLAG), \n\t\t\t\t'error': e.message \n\t\t\t};\n\t\t}\n\t}\n\n\tfunction setUserInput(inputContent, selection, tracking) {\n\t\treturn {\n\t\t\t'isValid': selection !== UNEXPECTED_INPUT,\n\t\t\t'content': inputContent,\n\t\t\t'selection': selection,\n\t\t\t'tracking': tracking\n\t\t}\n\t}\n\n\tfunction matchKey(options, input) {\n\t\treturn Object.keys(options).find(key => (\n\t\t\tinput.match(new RegExp(key, 'gi'))\n\t\t));\n\t}\n`;\n\nconst enableSubflowMode = `\n\tfunction enableSubflowMode(stateId, stateName) {\n\t\treturn { 'isActive': true, 'id': stateId, 'name': stateName };\n\t}\n`;\n\nconst disableSubflowMode = `\n\tfunction disableSubflowMode(stateId, stateName) {\n\t\treturn { 'isActive': false, 'id': stateId, 'name': stateName };\n\t}\n`;\n\nconst convertBoolToTextFlag =  `\n\tfunction convertBoolToTextFlag(bool) {\n\t\treturn bool ? 'Sim': 'Nao';\n\t}\n`;\n\nconst getFormattedDate = `\n\tfunction getFormattedDate() {\n\t\tconst now = new Date();\n\t\tnow.setHours(now.getHours());\n\n\t\tlet day = now.getDate();\n\t\tlet month = now.getMonth() + 1;\n\t\tlet year = now.getFullYear();\n\t\tlet hour = now.getHours();\n\t\tlet minutes = now.getMinutes();\n\n\t\tif (day < 10) day = '0' + day;\n\t\tif (month < 10) month = '0' + month;\n\t\tif (hour < 10) hour = '0' + hour;\n\t\tif (minutes < 10) minutes = '0' + minutes;\n\n\t\treturn day + '/' + month + '/' + year + ' ' + hour + ':' + minutes;\n\t}\n`;\n\nconst updateSession = `\n\tfunction updateSession(session, entrypoint, inputContent, origin) {\n\t\ttry {\n\t\t\tsession = createOrUpdateSession(session);\n\n\t\t\tsession.count = parseInt(session.count) + 1;\n\t\t\tsession.source = 'Orgânico';\n\t\t\tsession.group = 'Orgânico';\n\t\t\tsession.input = inputContent;\n\t\t\tsession.origin = origin;\n\t\t\tsession.entrypoint = false;\n\t\t\tsession.date = getFormattedDate();\n\n\t\t\tif (entrypoint && entrypoint !== 'default') {\n\t\t\t\tentrypoint = JSON.parse(entrypoint);\n\n\t\t\t\tif (entrypoint.matched === 'Sim') {\n\t\t\t\t\tsession.source = entrypoint.matchContent.source;\n\t\t\t\t\tsession.group = entrypoint.matchContent.group;\n\t\t\t\t\tsession.entrypoint = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn session;\n\t\t}\n\t\tcatch(e) {\n\t\t\tsession.error = e.message;\n\t\t\treturn session;\n\t\t}\n\t}\n\n\tfunction createOrUpdateSession(session) {\n\t\treturn !session ? createSession() : JSON.parse(session);\n\t}\n\n\tfunction createSession() {\n\t\treturn {\n\t\t\t'count': 0,\n\t\t\t'source': '',\n\t\t\t'input': '',\n\t\t\t'origin': '',\n\t\t\t'entrypoint': false,\n\t\t\t'date': ''\n\t\t}\n\t}\n`\n\nconst verifyEntrypoints = `\n\tfunction verifyEntrypoints(input, entrypoints) {\n\t\ttry {\n\t\t\tentrypoints = JSON.parse(entrypoints);\n\n\t\t\tconst entrypoint = matchRegex(entrypoints, input);\n\n\t\t\tif (!entrypoint) \n\t\t\t\treturn 'default';\n\n\t\t\treturn {\n\t\t\t\t'matched': 'Sim',\n\t\t\t\t'matchContent': entrypoint\n\t\t\t};\t\n\t\t}\n\t\tcatch(e) {\n\t\t\treturn 'default';\n\t\t}\n\t}\n\n\tfunction matchRegex(entrypoints, input) {\n\t\treturn entrypoints.find(e => input.match(new RegExp(e.regex.Pattern, 'gmi')));\n\t}\n`\n\nconst redirect = `\n\tfunction setOrigin({ \n\t\tservice = 'default',\n\t\tserviceId = 'default',\n\t\tstateId = 'default', \n\t\tstateName = 'default'\n\t} = {}) {\n\t\treturn {\n\t\t\t'service': service,\n\t\t\t'serviceId': serviceId,\n\t\t\t'stateId': stateId,\n\t\t\t'stateName': stateName\n\t\t}\n\t}\n\n\tfunction setDestination({\n\t\tstateId,\n\t\tstateName = 'default',\n\t\tsubflowStateName = 'default', \n\t\tsubflowStateId = 'default' \n\t} = {}) {\n\t\tif (!stateId) \n\t\t\treturn 'stateId is required for redirect destination.';\n\t\t\n\t\treturn {\n\t\t\t'stateId': stateId,\n\t\t\t'stateName': stateName,\n\t\t\t'subflowStateId': subflowStateId,\n\t\t\t'subflowStateName': subflowStateName\n\t\t}\n\t}\n\n\tfunction isModuleResponse(message, currentStateId) {\n\t\ttry  {\n\t\t\tif (!message) return false;\n\t\t\tmessage = JSON.parse(message);\n\t\t\treturn message.isModuleResponse && (message.to.stateId === currentStateId || message.to.subflowStateId === currentStateId);\n\t\t}\n\t\tcatch(e) {\n\t\t\treturn e.message\n\t\t}\n\t}\n\n\tfunction redirect(from, to, { skipCallerMessageSave = false, isModuleResponse = false } = {}) {\n\t\ttry {\n            if (typeof to === 'string') throw new Error(to);\n            \n\t\t\tconst message = { from: setOrigin(from) };\n\n\t\t\tif (to) message.to = to;\n\n\t\t\tmessage.skipCallerMessageSave = skipCallerMessageSave;\n\t\t\tmessage.isModuleResponse = isModuleResponse;\n\n\t\t\treturn message;\n\t\t}\n\t\tcatch(e) {\n\t\t\treturn {\n\t\t\t\t'from': setOrigin(from),\n\t\t\t\t'to': setDestination({ \n\t\t\t\t\tstateName: 'Redirect Error', \n\t\t\t\t\tstateId: '7f2feee4-c5b0-4d7c-b77a-91f6ce6a771b' \n\t\t\t\t}),\n\t\t\t\t'error': e.message,\n\t\t\t};\n\t\t}\n\t}\n`\n\nconst getOrigin = `\n\tfunction getOrigin(redirect, statePreviousName) {\n\t\tconst DEFAULT_ORIGIN =  'Parent Flow' + ' | ' + statePreviousName;\n\n\t\ttry {\n\t\t\tif (redirect && redirect !== 'default') {\n\t\t\t\tredirect = JSON.parse(redirect);\n\t\t\t\treturn redirect.from.service + ' | ' + redirect.from.stateName\n\t\t\t}\n\n\t\t\treturn DEFAULT_ORIGIN;\n\t\t}\n\t\tcatch(e) {\n\t\t\treturn 'Error: ' + e.message;\n\t\t}\n\t}\n`","inputVariables":[],"outputVariable":"globalScripts"},"conditions":[{"$$hashKey":"object:33964","values":[],"source":"context","comparison":"notExists","variable":"cache"}]},{"$id":"817e2232-2ae2-4e4f-86b8-b84b917bfd0a","$typeOfContent":"","type":"ExecuteScript","$title":"SET entrypoints","$invalid":false,"settings":{"function":"run","source":"const entrypoints = [\n {\n    text: 'Hi! I was in the website and I would like to know more about this product.',\n    isActive: true,\n    regex: /know\\s*more\\s*about\\s*this\\s*product/gmi,\n    source: 'Website Banner',\n    content: {\n      image: 'https://s3-sa-east-1.amazonaws.com/i.imgtake.takenet.com.br/yycnolzc.q22/notebooks-jpg.png',\n      description: '<b>So, are you looking for a notebook?</b>\\n\\nIntroducing the Future of Portability and Power: The 2024 Ultra-Modern Notebook!\\n\\nExperience the pinnacle of innovation with our latest ultra-modern notebook, designed for the discerning user who demands both style and substance. With its feather-light frame and robust performance, this notebook is the perfect fusion of form and function.'\n    },\n    createdAt: '11/04/2024'\n  }\n];\n\nfunction run() {\n  return entrypoints;\n}","inputVariables":[],"outputVariable":"entrypoints"},"conditions":[]},{"$id":"6ee9d982-c614-44a2-a0d0-422bbbc8a488","$typeOfContent":"","type":"ExecuteScript","$title":"SET components","$invalid":false,"settings":{"function":"run","source":"function run() {\n\tconst builders = [\n\t\tbuildMenuList,\n\t\tbuildQuickReply,\n\t\tbuildTextPlainMenu,\n\t\tinitWAInteractiveComponentProps\n\t];\n\n\treturn builders.join('\\n');\n}\n\nconst buildQuickReply = `\n\tfunction buildQuickReply({\n\t\tchannel = 'default', \n\t\ttext = 'BODY_TEXT',\n\t\toptions = [] \n\t} = {}) {\n\t\ttry {\n\t\t\tlet contentType = 'application/vnd.lime.select+json'\n\t\t\tlet content = {\n\t\t\t\tscope: 'immediate',\n\t\t\t\ttext: text,\n\t\t\t\toptions: options.map(option => ({ text: option }))\n\t\t\t}\n\n\t\t\tif (channel === 'WhatsApp') {\n\t\t\tcontentType = 'application/json'\n\t\t\tcontent = initWAInteractiveComponentProps('button')\n\t\t\t\t\n\t\t\tcontent.interactive.body = { text: text }\n\t\t\tcontent.interactive.action = {\n\t\t\t\tbuttons: options.map((option, index) => {\n\t\t\t\treturn { \n\t\t\t\t\ttype: 'reply', \n\t\t\t\t\treply: { id: index, title: option }}\n\t\t\t\t})\n\t\t\t}\n\t\t\t}\n\n\t\t\treturn { type: contentType, content: content }\n\t\t}\n\t\tcatch(e) {\n\t\t\treturn e.message;\n\t\t}\n\t}\n`\n\nconst buildMenuList = `\n\tfunction buildMenuList({\n\t\tchannel = 'default',\n\t\ttext = 'BODY_TEXT',\n\t\theader = { type: 'text', text: 'HEADER_TEXT' },\n\t\tfooter = { text: 'FOOTER_TEXT' },\n\t\toptions = [{ section: 'DEFAULT_SECTION', rows: [ { title: 'DEFAULT_OPTION', description: 'DEFAULT_DESCRIPTION' } ]}],\n\t\tbuttonText = 'BUTTON_TEXT'\n\t} = {}) {\n\t\ttry {\n\t\t\tlet contentType = 'application/vnd.lime.select+json'\n\t\t\tlet content = {\n\t\t\t\ttext: text,\n\t\t\t\toptions: options.reduce((result, section) => [ ...result, ...section.rows.map(row => ({ text: row.title })) ], [])\n\t\t\t}\n\t\t\n\t\t\tif (channel === 'WhatsApp') {\n\t\t\t\tcontentType = 'application/json'\n\t\t\t\tcontent = initWAInteractiveComponentProps('list')\n\t\t\t\n\t\t\t\tif (header.text && header.text !== 'HEADER_TEXT')\n\t\t\t\t\tcontent.interactive.header = header\n\t\t\t\n\t\t\t\tif (footer.text && footer.text !== 'FOOTER_TEXT')\n\t\t\t\t\tcontent.interactive.footer = footer\n\t\t\t\n\t\t\t\tcontent.interactive.action = {\n\t\t\t\t\tbutton: buttonText,\n\t\t\t\t\tsections: options.map((option) => { \n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\ttitle: option.section, \n\t\t\t\t\t\t\trows: option.rows.map((row, index) => {\n\t\t\t\t\t\t\t\tconst value = { id: option.section + index, title: row.title }\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tif (row.description)\n\t\t\t\t\t\t\t\t\tvalue[description] = row.description\n\n\t\t\t\t\t\t\t\treturn value\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t}) \n\t\t\t\t}\n\t\t\t}\n\t\t\n\t\t\treturn { type: contentType, content: content }\n\t\t}\n\t\tcatch(e) {\n\t\t\treturn e.message;\n\t\t}\n\t}\n`\n\nconst initWAInteractiveComponentProps = `\n\tfunction initWAInteractiveComponentProps(type) {\n\t\treturn {\n\t\t\trecipient_type: 'individual',\n\t\t\ttype: 'interactive',\n\t\t\tinteractive: { type }\n\t\t}\n\t}\n`\n\nconst buildTextPlainMenu = `\n\tfunction buildTextPlainMenu(menu) {\n\t\treturn {\n\t\t\t'type': 'text/plain',\n\t\t\t'content': menu\n\t\t}\n\t}\n` ","inputVariables":[],"outputVariable":"components"},"conditions":[{"$$hashKey":"object:30760","values":[],"source":"context","comparison":"notExists","variable":"cache"}]},{"$id":"b0190c82-285d-4ece-8eb6-5cbbda6d146f","$typeOfContent":"","type":"ExecuteScript","$title":"SET subflowIds","$invalid":false,"settings":{"function":"run","source":"function run() {\n\treturn {\n\t\tOnboarding: \"subflow:9f0f74c3-5b50-46ba-af50-7fcd3a3f1181\",\n\t\tFinalization: \"subflow:29f820b7-df92-4461-9987-46f0acaefc5b\",\n\t\tDesk: \"subflow:6588850e-97a3-4619-b2b7-5e7f6e9ee29c\",\n\t\tEntrypoints: \"subflow:50d68e92-815c-4421-b0a8-236d31f52afb\",\n\t\tPreFinalization: \"subflow:1d273c53-0ffd-4882-897b-3686ba8a0ca5\",\n\t\tMainMenu: \"subflow:76ebc8e8-e46e-4661-a013-172a130d5b22\"\n\t}\n}","inputVariables":[],"outputVariable":"subflowIds"},"conditions":[]},{"$id":"efd67aca-e6e3-4490-ab0c-d5a165e1b388","$typeOfContent":"","type":"ExecuteScript","$title":"RESET error","$invalid":false,"settings":{"function":"run","source":"function run() {\n\treturn {\n\t\t'id': 'default', \n\t\t'hasAIValidation': false,\n\t\t'hasSmalltalksValidation': true,\n\t\t'hasGlobalRegexValidation': true,\n\t\t'customErrorMessage': 'default'\n\t} \n}","inputVariables":[],"outputVariable":"error"},"conditions":[]},{"$id":"9b43fe75-c814-4c0e-ae28-2276838cda33","$typeOfContent":"","type":"ExecuteScript","$title":"RESET apiError","$invalid":false,"settings":{"function":"run","source":"function run() {\n\treturn {\n\t\t'id': 'default'\n\t}\n}","inputVariables":[],"outputVariable":"apiError"},"conditions":[]},{"$id":"8494c769-899d-4de5-8589-bf6efa9daa5c","$typeOfContent":"","type":"SetVariable","$title":"RESET redirect","$invalid":false,"settings":{"variable":"redirect","value":"default"},"conditions":[]},{"$id":"8baf6cf5-3f5e-4ec4-9167-91fc9856e15c","$typeOfContent":"","type":"SetVariable","$title":"SET cache","$invalid":false,"settings":{"variable":"cache","value":"Enabled","expiration":600},"conditions":[{"$$hashKey":"object:29335","values":[],"source":"context","comparison":"notExists","variable":"cache"}]},{"$id":"91f710b1-de98-49a8-a5c6-aebe1e7213a0","$typeOfContent":"","type":"SetVariable","$title":"RESET isModuleResponse","$invalid":false,"settings":{"variable":"isModuleResponse","value":"false"},"conditions":[]}],"$leavingCustomActions":[{"$id":"b7d4282e-3dbe-486f-93a0-be5e60c7bcc5","$typeOfContent":"","type":"ExecuteScript","$title":"SET lastStateWithInput","$invalid":false,"settings":{"function":"run","source":"// Register last StateId and StateName with an input on PARENT flow.\nfunction run(stateId, stateName) {\n\treturn {\n\t\t\"id\": stateId,\n\t\t\"name\": stateName\n\t}\n}","inputVariables":["state.id","state.name"],"outputVariable":"lastStateWithInput"},"conditions":[{"$$hashKey":"object:6389","values":["true"],"source":"context","comparison":"notEquals","variable":"subflow@isActive"},{"$$hashKey":"object:8441","values":["true"],"source":"context","comparison":"notEquals","variable":"onCascadeHandling"}]},{"$id":"0f7940ae-ce7c-4569-8528-87540c4b559d","$typeOfContent":"","type":"ExecuteScript","$title":"SET lastSubflowStateWithInput","$invalid":false,"settings":{"function":"run","source":"// Register last StateId and StateName with an input on SUBFLOW.\nfunction run(stateId, stateName) {\n\treturn {\n\t\t\"id\": stateId,\n\t\t\"name\": stateName\n\t}\n}","inputVariables":["state.id","state.name"],"outputVariable":"lastSubflowStateWithInput"},"conditions":[{"$$hashKey":"object:6746","values":["true"],"source":"context","comparison":"equals","variable":"subflow@isActive"},{"$$hashKey":"object:18565","values":["true"],"source":"context","comparison":"notEquals","variable":"onCascadeHandling"}]},{"$id":"29fbbaf0-0452-4f05-a2b5-f37c7f17ae1e","$typeOfContent":"","type":"ExecuteScript","$title":"SET firstSession","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nfunction run(entrypoint, inputContent) {\n\tconst session =  {\n\t\t'source': 'Error',\n\t\t'input': inputContent,\n\t\t'timestamp': getFormattedDate(),\n\t\t'entrypoint': false,\n\t\t'group': 'Orgânico'\n\t};\n\n\ttry {\n\t\tsession.source = 'Orgânico';\n\n\t\tif (entrypoint && entrypoint !== 'default') {\n\t\t\tentrypoint = JSON.parse(entrypoint);\n\n\t\t\tif (entrypoint.matched === 'Sim') {\n\t\t\t\tsession.source = entrypoint.matchContent.source;\n\t\t\t\tsession.entrypoint = true;\n\t\t\t\tsession.group = entrypoint.matchContent.group;\n\t\t\t}\n\t\t}\n\n\t\treturn session;\n\t}\n\tcatch(e) {\n\t\treturn {\n\t\t\t...session,\n\t\t\t'error': e.message\n\t\t}\n\t}\n}","inputVariables":["entrypoint","input.content"],"outputVariable":"firstSession"},"conditions":[{"$$hashKey":"object:798","values":[],"source":"context","comparison":"notExists","variable":"firstSession"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"global-actions","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"subflows":[{"shortName":"inputhandler4","flow":{"onboarding":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"fe4e3304-d4aa-4f62-9ed5-3a4311711289","type":"text/plain","content":"User input"},"editable":false,"deletable":false,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"014c6db8-0e98-42a9-b80b-d406c923e7c3","conditions":[{"source":"input","comparison":"matches","values":[".*"]}],"$id":"769d64c4-2615-46c6-82ac-0b1763133901","$connId":"con_3","$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"d642332b-2ffb-4f43-8921-b5bb82fbe80d","$typeOfContent":"","type":"SetVariable","$title":"SET service","$invalid":false,"settings":{"variable":"service","value":"Cascade"},"conditions":[]},{"$id":"7f68d70d-f269-4be4-b5fa-d3890a9cdc72","$typeOfContent":"","type":"SetVariable","$title":"SET inputContent","$invalid":false,"settings":{"variable":"inputContent","value":"{{input.content}}"},"conditions":[]},{"$id":"e6591fc2-04ed-4bf1-9381-5a266ef49630","$typeOfContent":"","type":"ExecuteScript","$title":"SET errorId","$invalid":false,"settings":{"function":"run","source":"const DEFAULT_VALUE = 'default';\n\nfunction run(error) {\n\ttry {\n\t\tconst { id } = JSON.parse(error);\n\n\t\treturn id || DEFAULT_VALUE;\n\t}\n\tcatch(e) {\n\t\treturn DEFAULT_VALUE;\n\t}\n}","inputVariables":["error"],"outputVariable":"errorId","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"c1fb5ad2-e65e-4679-a93e-8b5552d1b249","$typeOfContent":"","type":"ExecuteScript","$title":"SET genericErrorMessage","$invalid":false,"settings":{"function":"run","source":"function run() {\n\treturn \"Sorry, I could not understand you... 😞\\nHere, I can help you with the following options:\";\n}","inputVariables":[],"outputVariable":"genericErrorMessage","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"014c6db8-0e98-42a9-b80b-d406c923e7c3","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-62ad8daf-8bcb-46d3-8a4d-f01eae941ecd","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-5f60e2dc-e648-4667-9b92-f153bef18a02","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"onboarding","root":true,"$title":"Start","$position":{"top":"112px","left":"644px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fallback":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"58f4517b-314f-47ca-acf2-4b946ba42619","type":"text/plain","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"d83cf94d-8380-4a89-bb2f-2f81cff8a753","$typeOfContent":"","type":"SetVariable","$title":"SET innerException","$invalid":false,"settings":{"variable":"innerException","value":"true"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-cc3bbf0e-ed63-4cb8-b52b-4dca79b21d62","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"fallback","$title":"Exceptions","$position":{"top":"102px","left":"1796px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"end":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"89cb4e3c-6385-45a2-a715-c3ccee7922ca","type":"text/plain","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"end","end":true,"$title":"End","$position":{"top":"1518px","left":"643px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"welcome":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"81784f01-5755-4e14-927b-3b7256635b91","type":"text/plain","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"9f1573c9-47b1-4856-9353-16a38dfbbd5d","typeOfStateId":"state","$connId":"con_8","$id":"bb6e17a7-8c34-4b64-9b99-3ecbb3f9eb25","conditions":[{"source":"context","comparison":"equals","values":["Sim"],"variable":"isValidInputType"}],"$invalid":false},{"stateId":"d7b24c14-1093-4500-8d2b-cccacb58a7f7","typeOfStateId":"state","$connId":"con_13","$id":"58c78b3a-5a68-4569-9b55-2c2b0ad3fd8e","conditions":[{"source":"context","comparison":"equals","values":["Nao"],"variable":"isValidInputType"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"24a5b5df-204e-4658-8d11-70cd053d86e5","$typeOfContent":"","type":"ExecuteScript","$title":"SET isEmoji","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nconst EMOJI_REGEX = /((\\u00a9|\\u00ae|[\\u2000-\\u3300]|\\ud83c[\\ud000-\\udfff]|\\ud83d[\\ud000-\\udfff]|\\ud83e[\\ud000-\\udfff]))/gmi;\n\nfunction run(inputContent) {\n\ttry {\n\t\tconst isEmoji = EMOJI_REGEX.test(inputContent);\n\n\t\treturn convertBoolToTextFlag(isEmoji);\n\t}\n\tcatch(e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["inputContent"],"outputVariable":"isEmoji","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"11a771a7-501c-436d-a2a0-aafd17935151","$typeOfContent":"","type":"ExecuteScript","$title":"SET isLink","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nconst LINK_REGEX = /((ftp|http|https):\\/\\/[^ \"]+)/gmi;\n\nfunction run(inputContent) {\n\t\ttry {\n\t\tconst isLink = LINK_REGEX.test(inputContent);\n\n\t\treturn convertBoolToTextFlag(isLink);\n\t}\n\tcatch(e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["inputContent"],"outputVariable":"isLink","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"dffa40e7-a309-464b-93e6-815c61934cbf","$typeOfContent":"","type":"ExecuteScript","$title":"SET isText","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nconst isText = true;\n\nfunction run(inputContent) {\n\ttry {\n\t\tinputContent = JSON.parse(inputContent);\n\n\t\treturn convertBoolToTextFlag(!isText);\n\t}\n\tcatch(e) {\n\t\treturn convertBoolToTextFlag(isText);\n\t}\n}","inputVariables":["inputContent"],"outputVariable":"isText","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"3ad2c0be-4d59-4563-9efb-118077b6ac8a","$typeOfContent":"","type":"ExecuteScript","$title":"SET isValidInputType","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nfunction run(isEmoji, isLink, isText) {\n\ttry {\n\t\tconst isValidInputType = isEmoji === 'Nao' && \n\t\t\t\t\t\t\t\t\t\t\t\t   isLink === 'Nao' && \n\t\t\t\t\t\t\t\t\t\t\t\t   isText === 'Sim';\t\t\n\n\t\treturn convertBoolToTextFlag(isValidInputType);\n\t}\n\tcatch(e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["isEmoji","isLink","isText"],"outputVariable":"isValidInputType","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"d7b24c14-1093-4500-8d2b-cccacb58a7f7","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-77aa3b26-b203-4543-b212-ef19674741cf","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"welcome","$title":"Is an invalid input type?","$position":{"top":"394px","left":"643px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"9f1573c9-47b1-4856-9353-16a38dfbbd5d":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"6cc3e36d-d00a-470a-bb17-02f360242f88","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"3edf8756-68e8-4305-b8e9-108e60677f5c","typeOfStateId":"state","$connId":"con_18","$id":"63b877a9-90ac-4ff6-af65-b90555a5ca05","conditions":[{"source":"context","comparison":"notEquals","values":["false"],"variable":"error@hasGlobalRegexValidation"}],"$invalid":false},{"stateId":"59e96079-b77f-444d-bb10-fc9007f3930c","typeOfStateId":"state","$connId":"con_23","$id":"4b3567dd-09cf-42b3-ace2-fe22d6a2effc","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"59e96079-b77f-444d-bb10-fc9007f3930c","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"9f1573c9-47b1-4856-9353-16a38dfbbd5d","root":false,"$title":"Should look for Global Regex?","$position":{"top":"574px","left":"643px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"d7b24c14-1093-4500-8d2b-cccacb58a7f7":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"78687109-4483-49d7-88e9-9ef6f4cb846b","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"344dbffb-9ef6-4071-afb6-960ae38842ef","$typeOfContent":"","type":"ExecuteScript","$title":"SET inputType","$invalid":false,"settings":{"function":"run","source":"function run(inputContent) {\n\ttry {\n\t\tinputContent = JSON.parse(inputContent);\n\n\t\treturn inputContent.type;\n\t}\n\tcatch(e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["inputContent"],"outputVariable":"inputType","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"7f26b550-62fd-476e-a0f9-4c0ea5917e01","$typeOfContent":"","type":"ExecuteScript","$title":"SET errorId","$invalid":false,"settings":{"function":"run","source":"const DEFAULT_VALUE = 'default';\n\nfunction run(isEmoji, isLink, inputType) {\n\ttry {\n\t\tconst errorId = getInputTypeErrorId(inputType);\n\n\t\tif (errorId !== DEFAULT_VALUE) {\n\t\t\treturn errorId;\n\t\t}\n\n\t\tif (isEmoji === 'Sim') {\n\t\t\treturn 'EmojiError';\n\t\t}\n\n\t\tif (isLink === 'Sim') {\n\t\t\treturn 'LinkError';\n\t\t}\n\n\t\treturn DEFAULT_VALUE;\n\t}\n\tcatch(e) {\n\t\treturn DEFAULT_VALUE;\n\t}\n}\n\nfunction getInputTypeErrorId(inputType) {\n    const inputTypeErrorMapping = {\n        \"image\": \"ImageError\",\n        \"audio\": \"AudioError\",\n        \"video\": \"VideoError\",\n        \"application\": \"DocumentError\",\n    }\n\n    const key = Object.keys(inputTypeErrorMapping)\n\t\t.find(key => inputType.includes(key));\n\n    return inputTypeErrorMapping[key] || DEFAULT_VALUE;\n}","inputVariables":["isEmoji","isLink","inputType"],"outputVariable":"errorId","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"ed679157-831d-40e4-bb8a-8ea632f9f532","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-211bfc39-6f15-4250-a63d-04a1b0ddd340","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"d7b24c14-1093-4500-8d2b-cccacb58a7f7","root":false,"$title":"Handle invalid input type","$position":{"top":"394px","left":"878px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"59e96079-b77f-444d-bb10-fc9007f3930c":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"c98fab66-32e8-49e2-918e-e3976c69008c","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"42974860-9b0e-4e35-90e8-2500fdf7e07e","typeOfStateId":"state","$connId":"con_28","$id":"e65e3ce4-61b7-42ad-8139-fb444c62bd9c","conditions":[{"source":"context","comparison":"notEquals","values":["false"],"variable":"error@hasSmalltalksValidation"}],"$invalid":false},{"stateId":"bdfe7b0e-f56c-4fdd-b5aa-28fa8d6f5a69","typeOfStateId":"state","$connId":"con_33","$id":"cc83a501-d7e2-45dc-9298-7c6057e83415","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"bdfe7b0e-f56c-4fdd-b5aa-28fa8d6f5a69","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"59e96079-b77f-444d-bb10-fc9007f3930c","root":false,"$title":"Should look for Smalltalks?","$position":{"top":"730px","left":"644px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"bdfe7b0e-f56c-4fdd-b5aa-28fa8d6f5a69":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"6d8ac509-6651-408f-8403-16ab42ebd136","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"7b7d7c18-2e1d-421e-aee6-f195c77d1466","typeOfStateId":"state","$connId":"con_38","$id":"19673ae2-cf9f-4b2b-96fd-2672bbbd01b3","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"error@hasAIValidation"}],"$invalid":false},{"stateId":"ed679157-831d-40e4-bb8a-8ea632f9f532","typeOfStateId":"state","$connId":"con_43","$id":"ef80796e-b5fc-4b2d-b9bb-85f1a14c73be","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"ed679157-831d-40e4-bb8a-8ea632f9f532","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"bdfe7b0e-f56c-4fdd-b5aa-28fa8d6f5a69","root":false,"$title":"Should look for Intents?","$position":{"top":"884px","left":"644px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"ed679157-831d-40e4-bb8a-8ea632f9f532":{"$contentActions":[{"action":{"$id":"b8fed64f-d599-4db8-9fa0-e4cb725fc94f","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"d01415e9-ba8f-4741-a276-94c310b08a0d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"d01415e9-ba8f-4741-a276-94c310b08a0d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"da32df38-4160-402e-b9c2-13fa148e885d","$typeOfContent":"text","type":"SendMessage","settings":{"id":"b065e7dc-725a-4ea4-9135-715ad2abad1f","type":"text/plain","content":"{{errorMessage}}","metadata":{}},"$cardContent":{"document":{"id":"b065e7dc-725a-4ea4-9135-715ad2abad1f","type":"text/plain","content":"{{errorMessage}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"46d25c92-a747-4946-854f-3d670667f21a","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"a04ee4ac-1c0b-4b64-977f-5dee61b67b69","typeOfStateId":"state","$connId":"con_48","$id":"2028cdd2-04b0-44bd-a714-764995590b77","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"87ad6590-eb15-41d5-ac63-bf9e2226e944","$typeOfContent":"","type":"ExecuteScript","$title":"SET errorMapping","$invalid":false,"settings":{"function":"run","source":"function run(genericErrorMessage) {\n\tconst componentErrors = {\n\t\t\"MenuListError\": \"Sorry, but I could not understand you. Please, select one of the following options in the menu list:\",\n\t\t\"QuickReplyError\": \"Sorry, but you need to select one of the following buttons:\"\n\t}\n\n\tconst genericErrors = {\n\t\t\"default\": genericErrorMessage\n\t}\n\n\treturn {\n\t\t...componentErrors,\n\t\t...genericErrors\n\t}\n}","inputVariables":["genericErrorMessage"],"outputVariable":"errorMapping","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"b875476a-89a9-4d78-a77b-2b5bac9998e8","$typeOfContent":"","type":"ExecuteScript","$title":"SET errorMessage","$invalid":false,"settings":{"function":"run","source":"function run(\n\terrorMapping, \n\terrorId,\n\terror, \n\tdefaultErrorMessage) \n{\n\ttry {\n\t\tconst { customErrorMessage } = JSON.parse(error);\n\t\terrorMapping = JSON.parse(errorMapping);\n\n\t\tif (customErrorMessage && customErrorMessage !== 'default') \n\t\t\treturn customErrorMessage;\n\n\t\treturn errorMapping[errorId] || defaultErrorMessage;\n\t}\t\n\tcatch(e) {\n\t\treturn defaultErrorMessage;\n\t}\n}","inputVariables":["errorMapping","errorId","error"],"outputVariable":"errorMessage","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"1cfaf1d7-a23d-4356-a858-178830d2a3ab","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-ed15f645-5699-4d21-b8f6-6a4af1123789","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-5dc76bec-b035-464a-9b24-dcff68f72647","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"ed679157-831d-40e4-bb8a-8ea632f9f532","root":false,"$title":"Display error message","$position":{"top":"1028px","left":"644px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"3edf8756-68e8-4305-b8e9-108e60677f5c":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"97892106-ade1-43e1-80cd-b59f227feec4","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:4696"}],"$conditionOutputs":[{"stateId":"59e96079-b77f-444d-bb10-fc9007f3930c","typeOfStateId":"state","$connId":"con_53","$id":"a467e5da-618e-424c-a630-f9340e2a6c2d","conditions":[{"source":"context","comparison":"equals","values":["default"],"variable":"destination","$$hashKey":"object:4712"}],"$invalid":false,"$$hashKey":"object:4698"}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"e2c67f38-6617-4296-8032-51121904646c","$typeOfContent":"","type":"ExecuteScript","$title":"SET destination","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nfunction run(subflowIds, inputContent) {\n\tsubflowIds = JSON.parse(subflowIds);\n\n\tconst intentsRegex = {\n\t\t'^(quit)$|(quit|end|finish)\\\\s*conversation': 'Quit',\n\t\t'^(attendant)$|talk\\\\s*to\\\\s*(attendant|human|agent)': 'Attendant'\n\t}\n\n\tconst destinations = {\n\t\t'Quit': { \n\t\t\t'stateId': subflowIds.Finalization \n\t\t},\n\t\t'Attendant': {\n\t\t\t'stateId': subflowIds.Desk\n\t\t}\n\t}\n\n\tconst key = intentMatch(intentsRegex, normalizeInput(inputContent));\n\n\tconst intent = intentsRegex[key];\n\n\tconst destination = destinations[intent];\n\n\treturn destination ? setDestination(destination) : 'default';\n} \n\nfunction intentMatch(intents, input) {\n\treturn Object.keys(intents).find(key => input.match(new RegExp(key, 'gmi')))\n}\n\nfunction normalizeInput(text) {\n  return text.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '')\n}","inputVariables":["subflowIds","inputContent"],"outputVariable":"destination","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"1cfaf1d7-a23d-4356-a858-178830d2a3ab","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-940e2da6-eab9-4384-a150-191bdcbabbbb","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"3edf8756-68e8-4305-b8e9-108e60677f5c","root":false,"$title":"Handle Global Regex","$position":{"top":"644px","left":"397px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"42974860-9b0e-4e35-90e8-2500fdf7e07e":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"48259005-905b-4ca3-98dd-e6d8d661397e","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"bdfe7b0e-f56c-4fdd-b5aa-28fa8d6f5a69","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"42974860-9b0e-4e35-90e8-2500fdf7e07e","root":false,"$title":"Handle Smalltalks","$position":{"top":"742px","left":"871px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7b7d7c18-2e1d-421e-aee6-f195c77d1466":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"012a1077-564b-4b10-b062-3b622b567f95","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"ed679157-831d-40e4-bb8a-8ea632f9f532","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"7b7d7c18-2e1d-421e-aee6-f195c77d1466","root":false,"$title":"Handle AI Intents","$position":{"top":"896px","left":"870px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7b208e3c-7a73-4598-9217-00ca626b3a0f":{"$contentActions":[{"action":{"$id":"8925670c-6d8b-4e4d-808f-fe026daff393","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"57c3ebba-1551-4995-99d3-faa11801582a","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"57c3ebba-1551-4995-99d3-faa11801582a","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"33c81533-c003-4e50-b684-c7bb3c354375","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"{{menu@type}}","rawContent":"{{menu@content}}"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"b4ff39ae-e383-4be6-b1f6-ff4b3de129d5","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"c801abe4-433c-45a2-9cec-63092fca1b66","typeOfStateId":"state","$connId":"con_58","$id":"d349ab43-d67a-49a1-bfd0-cbbc41735a0b","conditions":[{"source":"context","comparison":"equals","values":["End conversation"],"variable":"userInput@selection"}],"$invalid":false},{"stateId":"1cfaf1d7-a23d-4356-a858-178830d2a3ab","typeOfStateId":"state","$connId":"con_63","$id":"7beb80e9-f7b3-4205-a77d-084ed5f49ee1","conditions":[{"source":"context","comparison":"equals","values":["Continue"],"variable":"userInput@selection"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"2225f2c7-a298-4246-a907-94af13cb17e3","$typeOfContent":"","type":"ExecuteScript","$title":"SET menu","$invalid":false,"settings":{"function":"run","source":"{{components}}\n\nfunction run() {\n\treturn buildQuickReply({\n\t\tchannel: '{{contact.source}}',\n\t\ttext: 'We can try again or end the conversation if you prefer. What would you like to do?',\n\t\toptions: [\n\t\t\t'Continue',\n\t\t\t'End conversation'\n\t\t]\n\t})\n}","inputVariables":[],"outputVariable":"menu","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"7c55db5e-451b-4d35-9509-38e9eb3485bf","$typeOfContent":"","type":"SetVariable","$title":"RESET errorCount = 0","$invalid":false,"settings":{"variable":"errorCount","value":"0"},"conditions":[{"values":["true"],"source":"context","comparison":"equals","variable":"userInput@isValid"}]}],"$leavingCustomActions":[{"$id":"58b84e6e-9b7b-4abb-809f-2fd35459bcc5","$typeOfContent":"","type":"ExecuteScript","$title":"SET userInput","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nfunction run(input) {\n\treturn processUserInput(input, {\n\t\t\"^(1)$|^(continue)$\": \"Continue\",\n\t\t\"^(2)$|^(end|quit)\\\\s*conversation$\": \"End conversation\",\n\t})\n}","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-04da091c-c5ed-40fe-b2d8-18b55b78dba3","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-d274bd0f-9b41-499d-aa48-2cd04b9424d9","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-8a41f4c8-f715-4df8-bbb9-2353d401b682","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-9afc6ad3-b62f-4fcb-95c8-dddb88925fe6","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"7b208e3c-7a73-4598-9217-00ca626b3a0f","root":false,"$title":"Handle persistent error","$position":{"top":"1254px","left":"904px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"1cfaf1d7-a23d-4356-a858-178830d2a3ab":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"b20faea7-2eae-43e9-9f4a-261db2073b01","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"end","typeOfStateId":"state","$connId":"con_68","$id":"5f15f6e7-44c6-486e-9ba0-2ea67597de53","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"6fc503a2-3c71-4fe2-809e-8568491b4a2d","$typeOfContent":"","type":"SetVariable","$title":"SET innerException","$invalid":false,"settings":{"variable":"innerException","value":"false"},"conditions":[]}],"$leavingCustomActions":[{"$id":"c2ec8b79-611c-4227-a933-8644280a270d","$typeOfContent":"","type":"ExecuteScript","$title":"SET redirect","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nfunction run(\n\tservice,\n\tentrypoint,\n\tsubflowIds,\n\texceptionMessage,\n\tdestination\n) {\n\tconst origin = setOrigin({\n\t\tservice: service,\n\t\tstateId: '{{state.id}}',\n\t\tstateName: '{{state.name}}'\n\t});\n\n\t// Handle entrypoint redirect\n\tif (entrypoint && entrypoint !== 'default') {\n\t\tsubflowIds = subflowIds && JSON.parse(subflowIds);\n\t\tconst destination = setDestination({ stateId: subflowIds.Onboarding });\n\t\treturn redirect(origin, destination);\n\t}\n\n\t// Handle global regex redirect\n\tif (destination && destination !== 'default') {\n\t\tdestination = JSON.parse(destination);\n\t\treturn redirect(origin, destination);\n\t}\n\n\t// If input does not match Entrypoint or Global Regex, then return to last state with input.\n\texceptionMessage = JSON.parse(exceptionMessage);\n\treturn exceptionMessage;\n}","inputVariables":["service","entrypoint","subflowIds","exceptionMessage","destination"],"outputVariable":"redirect","LocalTimeZoneEnabled":false},"conditions":[{"values":["default"],"source":"context","comparison":"equals","variable":"redirect"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-c79d3fdf-6804-4572-ab04-f5e5071dd372","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-b00166c3-5608-4553-8504-a8f62bd4efa9","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"1cfaf1d7-a23d-4356-a858-178830d2a3ab","root":false,"$title":"Leave Input Handler","$position":{"top":"1344px","left":"643px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a04ee4ac-1c0b-4b64-977f-5dee61b67b69":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"dc56b57a-d1d8-4fe5-9b76-08b6a0dcd590","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"7b208e3c-7a73-4598-9217-00ca626b3a0f","typeOfStateId":"state","$connId":"con_73","$id":"eddc3e24-c122-4d72-bd94-2618d0728d47","conditions":[{"values":["3"],"source":"context","comparison":"greaterThanOrEquals","variable":"errorCount"}],"$invalid":false},{"stateId":"1cfaf1d7-a23d-4356-a858-178830d2a3ab","typeOfStateId":"state","$connId":"con_78","$id":"3f2f5a68-e796-4cd6-9349-5eafd74ae7ba","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"f7656a86-12e2-46ae-a891-b17d3e0ba16b","$typeOfContent":"","type":"SetVariable","$title":"SET maxErrorCount","$invalid":false,"settings":{"variable":"maxErrorCount","value":"3"},"conditions":[]},{"$id":"b22480e8-1aa5-43f0-97c4-25ab3ff34a32","$typeOfContent":"","type":"ExecuteScript","$title":"SET currentExceptionOrigin","$invalid":false,"settings":{"function":"run","source":"function run(subflow, lastStateWithInput, lastSubflowStateWithInput) {\n\ttry {\n\t\tsubflow = JSON.parse(subflow);\n\n\t\tif (subflow.isActive) {\n\t\t\tlastSubflowStateWithInput = JSON.parse(lastSubflowStateWithInput);\n\n\t\t\treturn {\n\t\t\t\t\"flowId\": subflow.id,\n\t\t\t\t\"stateId\": lastSubflowStateWithInput.id\n\t\t\t}\n\t\t}\n\n\t\tlastStateWithInput = JSON.parse(lastStateWithInput);\n\n\t\treturn {\n\t\t\t\"flowId\": \"default\",\n\t\t\t\"stateId\": lastStateWithInput.id\n\t\t}\n\t}\n\tcatch(e) {\n\t\treturn {\n\t\t\t\"flowId\": \"default\",\n\t\t\t\"stateId\": \"default\",\n\t\t\t\"error\": e.message\n\t\t}\n\t}\n}","inputVariables":["subflow","lastStateWithInput","lastSubflowStateWithInput"],"outputVariable":"currentExceptionOrigin","LocalTimeZoneEnabled":false},"conditions":[{"values":["true"],"source":"context","comparison":"notEquals","variable":"innerException"}]},{"$id":"21fd0c75-9b5d-4ee5-89f1-e6fdb65257d9","$typeOfContent":"","type":"SetVariable","$title":"[C] SET previousExceptionOrigin","$invalid":false,"settings":{"variable":"previousExceptionOrigin","value":"{{currentExceptionOrigin}}"},"conditions":[{"values":[],"source":"context","comparison":"notExists","variable":"previousExceptionOrigin"},{"values":["true"],"source":"context","comparison":"notEquals","variable":"innerException"}]},{"$id":"8855487c-0179-424c-b447-34ebe5c5fc0e","$typeOfContent":"","type":"ExecuteScript","$title":"SET errorCount","$invalid":false,"settings":{"function":"run","source":"function run(errorCount, currentExceptionOrigin, previousExceptionOrigin, maxErrorCount) {\n    try {\n        if (!errorCount || errorCount === \"NaN\" || parseInt(errorCount) >= maxErrorCount) {\n            errorCount = 0;\n        }\n\n        currentExceptionOrigin = JSON.parse(currentExceptionOrigin);\n        previousExceptionOrigin = JSON.parse(previousExceptionOrigin);\n  \n        if (shouldIncrementErrorCount(currentExceptionOrigin, previousExceptionOrigin)) \n        {\n            return parseInt(errorCount) + 1;    \n        }\n\n        return 1;\n    }\n    catch(e) {\n        return errorCount;\n    }\n}\n\nfunction shouldIncrementErrorCount(currentException, previousException) {\n    const isSameFlow = currentException.flowId === previousException.flowId;\n    const isSameStateId = currentException.stateId === previousException.stateId;\n\n    return isSameFlow && isSameStateId;\n}","inputVariables":["errorCount","currentExceptionOrigin","previousExceptionOrigin","maxErrorCount"],"outputVariable":"errorCount","LocalTimeZoneEnabled":false},"conditions":[{"values":["true"],"source":"context","comparison":"notEquals","variable":"innerException"}]}],"$leavingCustomActions":[{"$id":"feae4081-64d9-4478-81ef-5e940450d10f","$typeOfContent":"","type":"SetVariable","$title":"SET previousExceptionOrigin","$invalid":false,"settings":{"variable":"previousExceptionOrigin","value":"{{currentExceptionOrigin}}"},"conditions":[{"values":["true"],"source":"context","comparison":"notEquals","variable":"innerException"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"1cfaf1d7-a23d-4356-a858-178830d2a3ab","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-d019d5c7-2dbc-4fbc-82a8-f7bc0813db55","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-e9ad5ad3-2d6f-4e47-a5c8-6a390b8725d3","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"a04ee4ac-1c0b-4b64-977f-5dee61b67b69","root":false,"$title":"Count error","$position":{"top":"1195px","left":"644px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"014c6db8-0e98-42a9-b80b-d406c923e7c3":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"8c749d28-4d59-4bce-b9f1-b7313f20f367","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"welcome","typeOfStateId":"state","$connId":"con_83","$id":"a5e01e06-b5f2-4b4e-b066-c4f53f1b4292","conditions":[{"source":"context","comparison":"notEquals","values":["Sim"],"variable":"entrypoint@matched"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"cd0efe2c-dfe8-4c86-85ed-a79eba2c8c7b","$typeOfContent":"","type":"ExecuteScript","$title":"SET entrypoint","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nfunction run(input, entrypoints) {\n\treturn verifyEntrypoints(input, entrypoints);\n}","inputVariables":["input.content","entrypoints"],"outputVariable":"entrypoint","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"88a32c8f-fd5a-4533-9016-847f46eca567","$typeOfContent":"","type":"ExecuteScript","$title":"[C] UPDATE session","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nfunction run(session, entrypoint, inputContent) {\n\ttry {\n\t\tconst origin = 'Cascata';\n\n\t\treturn updateSession(\n\t\t\tsession, \n\t\t\tentrypoint, \n\t\t\tinputContent, \n\t\t\torigin\n\t\t);\n\t} catch(e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["session","entrypoint","input.content"],"outputVariable":"session","LocalTimeZoneEnabled":false},"conditions":[{"values":["Sim"],"source":"context","comparison":"equals","variable":"entrypoint@matched"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"1cfaf1d7-a23d-4356-a858-178830d2a3ab","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-99efa366-cdfc-45e1-ac33-c9d7e9856490","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"014c6db8-0e98-42a9-b80b-d406c923e7c3","root":false,"$title":"Verify entrypoints","$position":{"top":"251px","left":"644px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c801abe4-433c-45a2-9cec-63092fca1b66":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"b846775a-0a94-47e5-9e5f-8509f4b7992d","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"3062c582-1e86-47d5-a432-e856b9f4463b","$typeOfContent":"","type":"ExecuteScript","$title":"SET redirect","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nfunction run(service, subflowIds) {\n\tsubflowIds = JSON.parse(subflowIds);\n\n\tconst origin = setOrigin({\n\t\tservice: service,\n\t\tstateId: '{{state.id}}',\n\t\tstateName: '{{state.name}}'\n\t});\n\n\tconst destination = setDestination({\n\t\tstateId: subflowIds.Finalization\n\t});\n\n\treturn redirect(origin, destination);\n}","inputVariables":["service","subflowIds"],"outputVariable":"redirect","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"1cfaf1d7-a23d-4356-a858-178830d2a3ab","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-54afbfe7-ef4a-4457-b1ad-c826797bb106","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"c801abe4-433c-45a2-9cec-63092fca1b66","root":false,"$title":"Persistent Error Go to Finalization","$position":{"top":"1254px","left":"1120px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}},"configuration":{"builder:minimumIntentScore":"0.5","builder:stateTrack":"false","builder:#localTimeZone":"E.South America Standard Time","builder:useTunnelOwnerContext":"false","TraceTargetType":"Http","TraceMode":"All","TraceTarget":"https://take-api-beholder.cs.blip.ai/api/traces/subflowlab","TraceCacheMode":"0"}},{"shortName":"apierrorhandler4","flow":{"onboarding":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"8c447ece-a028-4124-aa3e-d966dfeace69","type":"text/plain","content":"User input"},"editable":false,"deletable":false,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:16495"}],"$conditionOutputs":[{"stateId":"ed679157-831d-40e4-bb8a-8ea632f9f532","typeOfStateId":"state","$connId":"con_3","$id":"d388522f-54d6-41b6-90ac-c6b5d30a9b9b","conditions":[{"source":"input","comparison":"exists","values":[],"$$hashKey":"object:16511"}],"$invalid":false,"$$hashKey":"object:16497"}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"8c44bb0d-0b26-4861-9242-3cf6e872d0ae","$typeOfContent":"","type":"SetVariable","$title":"SET service","$invalid":false,"settings":{"variable":"service","value":"API Error Handler"},"conditions":[]},{"$id":"4ff55e09-edab-4c61-b3ef-8ee77fd1278f","$typeOfContent":"","type":"ExecuteScript","$title":"SET apiGenericErrorMessage","$invalid":false,"settings":{"function":"run","source":"function run() {\n\treturn \"Sorry, we had an internal problem... Try again later.\";\n}","inputVariables":[],"outputVariable":"apiGenericErrorMessage","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-4d0436ac-d964-401f-841c-3a9c302935e3","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-d931d8ec-efab-4d4f-afdc-0d7cb12f9003","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"onboarding","root":true,"$title":"Start","$position":{"top":"120px","left":"644px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fallback":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"f721da4c-1898-4b4a-aed7-817a1fec4991","type":"text/plain","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:16595"}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"a07f040c-d436-42f0-89d9-f4e311224e01","$typeOfContent":"","type":"ExecuteScript","$title":"SET redirect","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nfunction run(service) {\n\n\tconst origin = setOrigin({\n\t\tservice: service,\n\t\tstateId: '{{state.previous.id}}', \n\t\tstateName: '{{state.previous.name}}'\n\t});\n\n\treturn redirect(origin);\n}","inputVariables":["service"],"outputVariable":"redirect","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"end","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-301d3b25-7775-45d1-acfe-55f11d0cbd82","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"fallback","$title":"Exceptions","$position":{"top":"118px","left":"1480.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"end":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a4ae7f2a-eb06-4615-90c5-8789c855fd6d","type":"text/plain","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"end","end":true,"$title":"End","$position":{"top":"581px","left":"644px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"1cfaf1d7-a23d-4356-a858-178830d2a3ab":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"b20faea7-2eae-43e9-9f4a-261db2073b01","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"typeOfStateId":"state","$connId":"con_8","$id":"5f15f6e7-44c6-486e-9ba0-2ea67597de53","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false,"stateId":"end"}],"$enteringCustomActions":[{"$id":"73bc0710-ec3f-402b-b20d-5a7bedb2b2df","$typeOfContent":"","type":"ExecuteScript","$title":"SET subflow (disable)","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nfunction run(stateId, stateName) {\n\treturn disableSubflowMode(stateId, stateName);\n}","inputVariables":["state.id","state.name"],"outputVariable":"subflow","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"dfb7273d-a369-4a68-9960-65af039aa782","$typeOfContent":"","type":"ExecuteScript","$title":"SET redirect","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nfunction run(\n\tsubflow, \n\tlastStateWithInput, \n\tlastSubflowStateWithInput\n) {\n\tconst origin = setOrigin({\n\t\tservice: 'Cascade',\n\t\tstateId: '{{state.previous.id}}',\n\t\tstateName: '{{state.previous.name}}'\n\t});\n\n\t// Handle input exception  inside a subflow\n\tif (subflow) {\n\t\tsubflow = JSON.parse(subflow);\n\n\t\tif (subflow.isActive) {\n\t\t\tlastSubflowStateWithInput = JSON.parse(lastSubflowStateWithInput);\n\n\t\t\tconst destination = setDestination({\n\t\t\t\tstateId: subflow.id,\n\t\t\t\tstateName:  subflow.name,\n\t\t\t\tsubflowStateName: lastSubflowStateWithInput.name,\n\t\t\t\tsubflowStateId: lastSubflowStateWithInput.id\n\t\t\t});\n\n\t\t\treturn redirect(origin, destination); \n\t\t}\n\t}\n\n\t// Handle input exception on parent flow\n\tlastStateWithInput = JSON.parse(lastStateWithInput);\n\n\tconst destination = setDestination({\n\t\tservice: 'Parent Flow',\n\t\tstateId: lastStateWithInput.id\n\t});\n\n\treturn redirect(origin, destination);\n}","inputVariables":["subflow","lastStateWithInput","lastSubflowStateWithInput"],"outputVariable":"redirect","LocalTimeZoneEnabled":false},"conditions":[{"values":["default"],"source":"context","comparison":"equals","variable":"redirect"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"end","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-4accafe4-9308-4209-b19a-b7ecaffd6320","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"1cfaf1d7-a23d-4356-a858-178830d2a3ab","root":false,"$title":"Leave Subflow","$position":{"top":"434.714px","left":"644px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true},"ed679157-831d-40e4-bb8a-8ea632f9f532":{"$contentActions":[{"action":{"$id":"b8fed64f-d599-4db8-9fa0-e4cb725fc94f","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"d01415e9-ba8f-4741-a276-94c310b08a0d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"d01415e9-ba8f-4741-a276-94c310b08a0d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"da32df38-4160-402e-b9c2-13fa148e885d","$typeOfContent":"text","type":"SendMessage","settings":{"id":"b065e7dc-725a-4ea4-9135-715ad2abad1f","type":"text/plain","content":"{{errorMessage}}","metadata":{}},"$cardContent":{"document":{"id":"b065e7dc-725a-4ea4-9135-715ad2abad1f","type":"text/plain","content":"{{errorMessage}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"46d25c92-a747-4946-854f-3d670667f21a","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"1cfaf1d7-a23d-4356-a858-178830d2a3ab","typeOfStateId":"state","$connId":"con_13","$id":"82420a4c-e742-4dd3-a994-0477c5656127","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"87ad6590-eb15-41d5-ac63-bf9e2226e944","$typeOfContent":"","type":"ExecuteScript","$title":"SET apiErrorMapping","$invalid":false,"settings":{"function":"run","source":"function run(apiGenericErrorMessage) {\n\tconst apiErrors = {\n\t\t\"CpfNotFound\": \"O CPF é válido, mas não foi encontrado em nosso banco de dados.\\n\\nPodemos tentar novamente?\"\n\t};\n\n\tconst genericErrors = {\n\t\t\"default\": apiGenericErrorMessage\n\t}\n\n\treturn {\n\t\t...apiErrors,\n\t\t...genericErrors\n\t}\n}","inputVariables":["apiGenericErrorMessage"],"outputVariable":"apiErrorMapping","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"b875476a-89a9-4d78-a77b-2b5bac9998e8","$typeOfContent":"","type":"ExecuteScript","$title":"SET errorMessage","$invalid":false,"settings":{"function":"run","source":"function run(apiErrorMapping, apiError) \n{\n\ttry {\n\t\tconst { id, customErrorMessage } = JSON.parse(apiError);\n\t\tapiErrorMapping = JSON.parse(apiErrorMapping);\n\n\t\tif (customErrorMessage && customErrorMessage !== 'default') \n\t\t\treturn customErrorMessage;\n\n\t\treturn apiErrorMapping[id] || apiErrorMapping['default'];\n\t}\t\n\tcatch(e) {\n\t\treturn apiErrorMapping['default'];\n\t}\n}","inputVariables":["apiErrorMapping","apiError"],"outputVariable":"errorMessage","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"$invalid":false,"typeOfStateId":"state","stateId":"1cfaf1d7-a23d-4356-a858-178830d2a3ab"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-88e1a643-6393-439b-99d9-008e23da81d3","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-24833af4-178d-43de-989f-72c70fd62d39","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"ed679157-831d-40e4-bb8a-8ea632f9f532","root":false,"$title":"Display error message","$position":{"top":"266.714px","left":"644px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true}},"configuration":{"builder:minimumIntentScore":"0.5","builder:stateTrack":"false","builder:#localTimeZone":"E.South America Standard Time"}},{"shortName":"finalization4","flow":{"onboarding":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"8c447ece-a028-4124-aa3e-d966dfeace69","type":"text/plain","content":"User input"},"editable":false,"deletable":false,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"b7598244-4148-498b-a4a7-6723cf33edd4","typeOfStateId":"state","$connId":"con_3","$id":"bea2dc50-239c-424a-8e36-c6587e1688e4","conditions":[{"values":[],"source":"context","comparison":"exists","variable":"message@to.subflowStateId"},{"values":["default"],"source":"context","comparison":"notEquals","variable":"message@to.subflowStateId"}],"$invalid":false},{"stateId":"dc544df9-e33e-42b3-b70d-ddb5e606f695","conditions":[{"source":"input","comparison":"matches","values":[".*"]}],"$id":"e3e2c8fb-b377-4909-8a4a-84b18136d650","$connId":"con_8","$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"0a3af1b5-da6b-46a2-966f-2125fa00d6db","$typeOfContent":"","type":"TrackEvent","$title":"Service origem","$invalid":false,"settings":{"extras":{},"category":"{{subflow@name}} origem","action":"{{origin}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-20f3167c-5dac-42d5-b04a-7b086afd0bfc","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"onboarding","root":true,"$title":"Start","$position":{"top":"82px","left":"644px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fallback":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"f721da4c-1898-4b4a-aed7-817a1fec4991","type":"text/plain","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:12776"}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"9cd6492a-3bb6-446c-9622-604ee4040496","$typeOfContent":"","type":"ExecuteScript","$title":"SET redirect","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nfunction run(subflow) {\n\tsubflow = JSON.parse(subflow)\n\n\tconst origin = setOrigin({\n\t\tservice: subflow.name,\n\t\tserviceId: subflow.id,\n\t\tstateId: '{{state.previous.id}}', \n\t\tstateName: '{{state.previous.name}}'\n\t});\n\n\treturn redirect(origin);\n}","inputVariables":["subflow"],"outputVariable":"redirect","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"end","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-302548c6-4cfc-4ebc-b6eb-edf81f49a573","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"fallback","$title":"Exceptions","$position":{"top":"79px","left":"1530px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"end":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a4ae7f2a-eb06-4615-90c5-8789c855fd6d","type":"text/plain","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"end","end":true,"$title":"End","$position":{"top":"540px","left":"644px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"dc544df9-e33e-42b3-b70d-ddb5e606f695":{"$contentActions":[{"action":{"$id":"5352d3ad-087e-424a-896a-29db31b9e3c3","$typeOfContent":"","type":"SendMessage","settings":{"id":"00000000-0000-0000-0000-000000000000","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"00000000-0000-0000-0000-000000000000","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left","editing":false}},"$invalid":false},{"action":{"$id":"6fd2cfcc-6c48-4380-ba6f-03524b42bce2","$typeOfContent":"","type":"SendMessage","settings":{"id":"00000000-0000-0000-0000-000000000001","type":"text/plain","content":"I would like to thank you! See ya! 😉👍","metadata":{}},"$cardContent":{"document":{"id":"00000000-0000-0000-0000-000000000001","type":"text/plain","content":"I would like to thank you! See ya! 😉👍"},"editable":true,"deletable":true,"position":"left","editing":false}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"12d9958f-be3e-4bd1-8e11-8df19d026aae","type":"text/plain","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"1cfaf1d7-a23d-4356-a858-178830d2a3ab","typeOfStateId":"state","$connId":"con_13","$id":"2b381e54-bdce-48b0-b653-f88456c9e551","conditions":[{"source":"input","comparison":"notExists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"1cfaf1d7-a23d-4356-a858-178830d2a3ab","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-9075d84c-1ab5-4cea-b305-2a34919daf5c","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"dc544df9-e33e-42b3-b70d-ddb5e606f695","$title":"End conversation message","$position":{"top":"233px","left":"644px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"1cfaf1d7-a23d-4356-a858-178830d2a3ab":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"b20faea7-2eae-43e9-9f4a-261db2073b01","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:12853"}],"$conditionOutputs":[{"typeOfStateId":"state","$connId":"con_18","$id":"5f15f6e7-44c6-486e-9ba0-2ea67597de53","conditions":[{"source":"input","comparison":"exists","values":[],"$$hashKey":"object:12869"}],"$invalid":false,"stateId":"end","$$hashKey":"object:12855"}],"$enteringCustomActions":[{"$id":"47b3a282-0f29-408d-8c22-0f58fa5a5120","$typeOfContent":"","type":"ExecuteScript","$title":"SET subflow (disable)","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nfunction run(stateId, stateName) {\n\treturn disableSubflowMode(stateId, stateName);\n}","inputVariables":["state.id","state.name"],"outputVariable":"subflow","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"2823651a-eb91-4f4b-8973-6b9ab1693c2e","$typeOfContent":"","type":"ExecuteScript","$title":"SET redirect","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nfunction run(subflow) {\n\tsubflow = JSON.parse(subflow)\n\n\tconst origin = setOrigin({\n\t\tservice: subflow.name,\n\t\tserviceId: subflow.id, \n\t\tstateId: '{{state.previous.id}}', \n\t\tstateName: '{{state.previous.name}}'\n\t});\n\n\treturn redirect(origin);\n}","inputVariables":["subflow"],"outputVariable":"redirect","LocalTimeZoneEnabled":false},"conditions":[{"values":["default"],"source":"context","comparison":"equals","variable":"redirect","$$hashKey":"object:8585"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"end","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-7e38dcdb-3976-41fa-a840-fa882f4cfa0c","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"1cfaf1d7-a23d-4356-a858-178830d2a3ab","root":false,"$title":"Leave Subflow","$position":{"top":"393px","left":"644px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true},"b7598244-4148-498b-a4a7-6723cf33edd4":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"48b64c7d-32e8-4a27-ab76-ce05e2fa9b6d","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"{{message@to.subflowStateId}}","$invalid":false,"typeOfStateId":"variable"},"isAiGenerated":false,"$tags":[],"id":"b7598244-4148-498b-a4a7-6723cf33edd4","root":false,"$title":"Go to subflowStateId","$position":{"top":"81px","left":"875px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}},"configuration":{"builder:minimumIntentScore":"0.5","builder:stateTrack":"false","builder:#localTimeZone":"E.South America Standard Time"}},{"shortName":"desk6","flow":{"onboarding":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"8c447ece-a028-4124-aa3e-d966dfeace69","type":"text/plain","content":"User input"},"editable":false,"deletable":false,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"b7598244-4148-498b-a4a7-6723cf33edd4","typeOfStateId":"state","$connId":"con_3","$id":"bea2dc50-239c-424a-8e36-c6587e1688e4","conditions":[{"values":[],"source":"context","comparison":"exists","variable":"message@to.subflowStateId"},{"values":["default"],"source":"context","comparison":"notEquals","variable":"message@to.subflowStateId"}],"$invalid":false},{"stateId":"53c998df-561d-4a6b-a24b-c1268bea6f98","conditions":[{"source":"input","comparison":"matches","values":[".*"]}],"$id":"e3e2c8fb-b377-4909-8a4a-84b18136d650","$connId":"con_8","$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"bc80133d-2a8e-49e8-a9ca-a5066d7b5a40","$typeOfContent":"","type":"TrackEvent","$title":"Service origem","$invalid":false,"settings":{"extras":{},"category":"{{subflow@name}} origem","action":"{{origin}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-c1153c11-2b00-4a6f-aabe-d28af0b122cc","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"onboarding","root":true,"$title":"Start","$position":{"top":"109px","left":"644px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fallback":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"f721da4c-1898-4b4a-aed7-817a1fec4991","type":"text/plain","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"3d552173-70ef-468d-8c77-50440efbe049","$typeOfContent":"","type":"ExecuteScript","$title":"SET redirect","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nfunction run(subflow) {\n\tsubflow = JSON.parse(subflow)\n\n\tconst origin = setOrigin({\n\t\tservice: subflow.name,\n\t\tserviceId: subflow.id,\n\t\tstateId: '{{state.previous.id}}', \n\t\tstateName: '{{state.previous.name}}'\n\t});\n\n\treturn redirect(origin);\n}","inputVariables":["subflow"],"outputVariable":"redirect","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"end","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-26960a50-d74d-47aa-bce0-000038fcbe89","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"fallback","$title":"Exceptions","$position":{"top":"86px","left":"1781px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"end":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a4ae7f2a-eb06-4615-90c5-8789c855fd6d","type":"text/plain","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"end","end":true,"$title":"End","$position":{"top":"248.333px","left":"2038.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"1cfaf1d7-a23d-4356-a858-178830d2a3ab":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"b20faea7-2eae-43e9-9f4a-261db2073b01","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:23106"}],"$conditionOutputs":[{"typeOfStateId":"state","$connId":"con_13","$id":"5f15f6e7-44c6-486e-9ba0-2ea67597de53","conditions":[{"source":"input","comparison":"exists","values":[],"$$hashKey":"object:23122"}],"$invalid":false,"stateId":"end","$$hashKey":"object:23108"}],"$enteringCustomActions":[{"$id":"47b3a282-0f29-408d-8c22-0f58fa5a5120","$typeOfContent":"","type":"ExecuteScript","$title":"SET subflow (disable)","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nfunction run(stateId, stateName) {\n\treturn disableSubflowMode(stateId, stateName);\n}","inputVariables":["state.id","state.name"],"outputVariable":"subflow","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"08db33b4-fdae-4fc1-b15c-bb30bcd346f4","$typeOfContent":"","type":"ExecuteScript","$title":"SET redirect","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nfunction run(subflow) {\n\tsubflow = JSON.parse(subflow)\n\n\tconst origin = setOrigin({\n\t\tservice: subflow.name,\n\t\tserviceId: subflow.id, \n\t\tstateId: '{{state.previous.id}}', \n\t\tstateName: '{{state.previous.name}}'\n\t});\n\n\treturn redirect(origin);\n}","inputVariables":["subflow"],"outputVariable":"redirect","LocalTimeZoneEnabled":false},"conditions":[{"values":["default"],"source":"context","comparison":"equals","variable":"redirect","$$hashKey":"object:23275"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"end","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-d6911ea5-0f12-4c3b-9c6a-87a155137853","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"1cfaf1d7-a23d-4356-a858-178830d2a3ab","root":false,"$title":"Leave Subflow","$position":{"top":"83.75px","left":"2036.5px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true},"b7598244-4148-498b-a4a7-6723cf33edd4":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"48b64c7d-32e8-4a27-ab76-ce05e2fa9b6d","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"{{message@to.subflowStateId}}","$invalid":false,"typeOfStateId":"variable"},"isAiGenerated":false,"$tags":[],"id":"b7598244-4148-498b-a4a7-6723cf33edd4","root":false,"$title":"Go to subflowStateId","$position":{"top":"108px","left":"877px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"desk:73c7a455-c2e3-4b07-830b-d18512c8936e":{"$contentActions":[{"input":{"bypass":false,"conditions":[{"source":"context","variable":"desk_forwardToDeskState_status","comparison":"equals","values":["Success"]}],"$cardContent":{"document":{"id":"b2082f45-8f40-4650-85e8-8e6f430205f2","type":"text/plain","textContent":"User input","content":"User input"},"editable":false,"deletable":false,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"$isDeskOutput":true,"$isDeskCustomOutput":true,"conditions":[{"source":"context","variable":"desk_forwardToDeskState_status","comparison":"equals","values":["OutOfAttendanceHour"]}],"$invalid":false,"stateId":"a69eb3e2-d1de-491f-b5c0-11905508e13a","$connId":"con_18","$id":"62f87293-34ac-45e0-acb0-dc1d6a239fb9"},{"$isDeskOutput":true,"conditions":[{"source":"context","variable":"input.type","comparison":"equals","values":["application/vnd.iris.ticket+json"]},{"source":"context","variable":"input.content@status","comparison":"equals","values":["ClosedAttendant"]}],"$invalid":false,"stateId":"fbe8afd1-a3f6-46ae-9a24-f00f846414e4","$connId":"con_23","$id":"5841d942-77a9-49f4-a760-91c2271bfa60"},{"$isDeskOutput":true,"conditions":[{"source":"context","variable":"input.type","comparison":"equals","values":["application/vnd.iris.ticket+json"]},{"source":"context","variable":"input.content@status","comparison":"equals","values":["ClosedClient"]}],"$invalid":false,"stateId":"fbe8afd1-a3f6-46ae-9a24-f00f846414e4","$connId":"con_28","$id":"f1cc50f5-9f3f-42a5-a460-7f601d59c00a"},{"$isDeskOutput":true,"conditions":[{"source":"context","variable":"input.type","comparison":"equals","values":["application/vnd.iris.ticket+json"]},{"source":"context","variable":"input.content@status","comparison":"equals","values":["ClosedClientInactivity"]}],"$invalid":false,"stateId":"fbe8afd1-a3f6-46ae-9a24-f00f846414e4","$connId":"con_33","$id":"548774d8-6a00-4fb6-ba5c-743a6eb016b3"},{"$isDeskOutput":true,"$isDeskDefaultOutput":true,"conditions":[{"source":"context","variable":"desk_forwardToDeskState_status","comparison":"equals","values":["Error"]}],"stateId":"fallback","$invalid":false}],"$enteringCustomActions":[{"$id":"5b6568c6-b5f2-4f6a-becc-5284f4c00dfd","$typeOfContent":"","type":"ForwardToDesk","conditions":[],"settings":{},"$invalid":false}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"desk:73c7a455-c2e3-4b07-830b-d18512c8936e","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"desk:73c7a455-c2e3-4b07-830b-d18512c8936e","deskStateVersion":"3.0.0","root":false,"$title":"Customer service","$afterStateChangedActions":[{"$id":"b4aee71d-64b1-47a9-817d-ea592ae79ea0","$typeOfContent":"","type":"LeavingFromDesk","conditions":[],"settings":{}}],"$position":{"top":"445.714px","left":"643.857px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fbe8afd1-a3f6-46ae-9a24-f00f846414e4":{"$contentActions":[{"action":{"$id":"1f58b99e-7365-4e6c-b9a7-58e3d17bd7fc","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"4afff67c-8f1e-4df8-9cf9-929078703e21","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"4afff67c-8f1e-4df8-9cf9-929078703e21","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:22857"},{"action":{"$id":"88b47769-f376-488c-8f38-e424eab463c4","$typeOfContent":"text","type":"SendMessage","settings":{"id":"96a7933c-7183-4448-9d07-952d4ae8c1fd","type":"text/plain","content":"The attendance was finished!","metadata":{}},"$cardContent":{"document":{"id":"96a7933c-7183-4448-9d07-952d4ae8c1fd","type":"text/plain","content":"The attendance was finished!"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:22858"},{"input":{"bypass":true,"$cardContent":{"document":{"id":"32fa467f-8407-496f-ab5f-fdcf973ec830","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:22859"}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"22bcfb7f-ffcf-4207-9abe-be3d92bf7c6c","$typeOfContent":"","type":"ExecuteScript","$title":"SET redirect","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nfunction run(subflow, subflowIds) {\n\tsubflow = JSON.parse(subflow)\n\tsubflowIds =  JSON.parse(subflowIds)\n\n\tconst origin = setOrigin({\n\t\tservice: subflow.name,\n\t\tserviceId: subflow.id,\n\t\tstateId: '{{state.previous.id}}',\n\t\tstateName: '{{state.previous.name}}'\n\t})\n\n\tconst destination = setDestination({\n\t\tstateId: subflowIds.SomethingMore\n\t})\n\n\treturn redirect(origin, destination)\n}","inputVariables":["subflow","subflowIds"],"outputVariable":"redirect","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"1cfaf1d7-a23d-4356-a858-178830d2a3ab","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-24d92b48-7284-4859-81ae-9d80825bb935","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-faa00536-f4de-4b4d-b575-d2e534375423","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"fbe8afd1-a3f6-46ae-9a24-f00f846414e4","root":false,"$title":"Ticket closed","$position":{"top":"594.286px","left":"644px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a69eb3e2-d1de-491f-b5c0-11905508e13a":{"$contentActions":[{"action":{"$id":"f28c2a5f-89c6-463e-80f2-fdab471711ca","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"037bb2d3-78c6-40d8-89ff-d8539129ea44","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"037bb2d3-78c6-40d8-89ff-d8539129ea44","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"63c49578-9449-4ab9-883f-cedc784e6251","$typeOfContent":"text","type":"SendMessage","settings":{"id":"81625cd4-6776-4fc8-b8f5-7fd5ca5d74fd","type":"text/plain","content":"However, I just noticed that we are out of our working hour for now. You can try to contact us from Monday to Friday at 8am to 6pm.  ","metadata":{}},"$cardContent":{"document":{"id":"81625cd4-6776-4fc8-b8f5-7fd5ca5d74fd","type":"text/plain","content":"However, I just noticed that we are out of our working hour for now. You can try to contact us from Monday to Friday at 8am to 6pm.  "},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"b29c6a1d-980b-42a0-99f2-f350c621c9c8","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"cff1c1fb-f7a1-423c-9309-54eb54eaf04f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"cff1c1fb-f7a1-423c-9309-54eb54eaf04f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"3d4d602d-0f3c-442d-93f7-09297cc3bdf5","$typeOfContent":"text","type":"SendMessage","settings":{"id":"0458f342-7e7b-4ad7-9c79-d40882b76243","type":"text/plain","content":"Please, go back later.","metadata":{}},"$cardContent":{"document":{"id":"0458f342-7e7b-4ad7-9c79-d40882b76243","type":"text/plain","content":"Please, go back later."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"354cf337-d4b5-43c0-baa9-6fc724da31a1","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"6e307674-7842-4645-bfe0-80c412019f34","$typeOfContent":"","type":"ExecuteScript","$title":"SET redirect","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nfunction run(service, subflowIds) {\n\tsubflowIds = JSON.parse(subflowIds);\n\n\tconst origin = setOrigin({\n\t\tservice: service,\n\t\tstateId: '{{state.id}}',\n\t\tstateName: '{{state.name}}'\n\t});\n\n\tconst destination = setDestination({\n\t\tstateId: subflowIds.PreFinalization\n\t})\n\n\treturn redirect(origin, destination);\n}","inputVariables":["service","subflowIds"],"outputVariable":"redirect","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"1cfaf1d7-a23d-4356-a858-178830d2a3ab","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-075a98a9-00a9-41b5-b9af-6997f1c15901","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-0ab25461-a5de-42a8-ac4d-a15422b8820c","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"a69eb3e2-d1de-491f-b5c0-11905508e13a","root":false,"$title":"T.1.0.1 Out of working time","$position":{"top":"423px","left":"894px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"53c998df-561d-4a6b-a24b-c1268bea6f98":{"$contentActions":[{"action":{"$id":"0aa306ba-c991-4ba1-aca7-ec4bbdb5ed8b","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"d68b1cd6-f571-43fb-ab83-892b1b890b03","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"d68b1cd6-f571-43fb-ab83-892b1b890b03","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"fc08d05c-fa00-496b-8f4e-b38a9a19786c","$typeOfContent":"text","type":"SendMessage","settings":{"id":"fd2402ef-f441-4953-8faa-cdaaf070b64b","type":"text/plain","content":"I will forward you to one of ours attendants.","metadata":{}},"$cardContent":{"document":{"id":"fd2402ef-f441-4953-8faa-cdaaf070b64b","type":"text/plain","content":"I will forward you to one of ours attendants."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"ead99fab-0530-4723-bb7a-98527bbf40eb","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"desk:73c7a455-c2e3-4b07-830b-d18512c8936e","typeOfStateId":"state","$connId":"con_38","$id":"2c4099c5-4a10-4abf-a604-98b5b1a503d4","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-8fa55800-df45-4f1a-bbdd-251ecdbd052e","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"53c998df-561d-4a6b-a24b-c1268bea6f98","root":false,"$title":"T.1.0.2 Pre desk message","$position":{"top":"282px","left":"644px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}},"configuration":{"builder:minimumIntentScore":"0.5","builder:stateTrack":"false","builder:#localTimeZone":"E.South America Standard Time"}},{"shortName":"entrypoints5","flow":{"onboarding":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"8c447ece-a028-4124-aa3e-d966dfeace69","type":"text/plain","content":"User input"},"editable":false,"deletable":false,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"b7598244-4148-498b-a4a7-6723cf33edd4","typeOfStateId":"state","$connId":"con_3","$id":"bea2dc50-239c-424a-8e36-c6587e1688e4","conditions":[{"values":[],"source":"context","comparison":"exists","variable":"message@to.subflowStateId"},{"values":["default"],"source":"context","comparison":"notEquals","variable":"message@to.subflowStateId"}],"$invalid":false},{"stateId":"c0ac19e8-6de3-473c-97b2-aa157140c54d","typeOfStateId":"state","$connId":"con_8","$id":"1828415c-5ce6-409b-a57e-7c6907d1ac85","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"f0190cca-9294-4665-a4dc-bd29039beb61","$typeOfContent":"","type":"TrackEvent","$title":"Service origem","$invalid":false,"settings":{"extras":{},"category":"{{subflow@name}} origem","action":"{{origin}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"c0ac19e8-6de3-473c-97b2-aa157140c54d","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-46306fc7-b696-4ca4-bb7a-3f6023e209c1","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"onboarding","root":true,"$title":"Start","$position":{"top":"120px","left":"644px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fallback":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"f721da4c-1898-4b4a-aed7-817a1fec4991","type":"text/plain","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"024b86e7-3a45-439c-92ea-dec1614754d1","$typeOfContent":"","type":"ExecuteScript","$title":"SET redirect","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nfunction run(subflow) {\n\tsubflow = JSON.parse(subflow)\n\n\tconst origin = setOrigin({\n\t\tservice: subflow.name,\n\t\tserviceId: subflow.id,\n\t\tstateId: '{{state.previous.id}}', \n\t\tstateName: '{{state.previous.name}}'\n\t});\n\n\treturn redirect(origin);\n}","inputVariables":["subflow"],"outputVariable":"redirect","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"end","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-863d8ed9-a091-49ec-875b-b61d3b786278","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"fallback","$title":"Exceptions","$position":{"top":"117px","left":"1767px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"end":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a4ae7f2a-eb06-4615-90c5-8789c855fd6d","type":"text/plain","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"end","end":true,"$title":"End","$position":{"top":"284px","left":"1985px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"1cfaf1d7-a23d-4356-a858-178830d2a3ab":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"b20faea7-2eae-43e9-9f4a-261db2073b01","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"typeOfStateId":"state","$connId":"con_13","$id":"5f15f6e7-44c6-486e-9ba0-2ea67597de53","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false,"stateId":"end"}],"$enteringCustomActions":[{"$id":"47b3a282-0f29-408d-8c22-0f58fa5a5120","$typeOfContent":"","type":"ExecuteScript","$title":"SET subflow (disable)","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nfunction run(stateId, stateName) {\n\treturn disableSubflowMode(stateId, stateName);\n}","inputVariables":["state.id","state.name"],"outputVariable":"subflow","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"71386f21-33fb-444c-a743-f4ac9c1b5b7b","$typeOfContent":"","type":"ExecuteScript","$title":"SET redirect","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nfunction run(subflow) {\n\tsubflow = JSON.parse(subflow)\n\n\tconst origin = setOrigin({\n\t\tservice: subflow.name,\n\t\tserviceId: subflow.id, \n\t\tstateId: '{{state.previous.id}}', \n\t\tstateName: '{{state.previous.name}}'\n\t});\n\n\treturn redirect(origin);\n}","inputVariables":["subflow"],"outputVariable":"redirect","LocalTimeZoneEnabled":false},"conditions":[{"values":["default"],"source":"context","comparison":"equals","variable":"redirect"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"end","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-8d22cdd6-1f03-4285-ae15-2c123afa4d39","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"1cfaf1d7-a23d-4356-a858-178830d2a3ab","root":false,"$title":"Leave Subflow","$position":{"top":"118.143px","left":"1985px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true},"b7598244-4148-498b-a4a7-6723cf33edd4":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"48b64c7d-32e8-4a27-ab76-ce05e2fa9b6d","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"{{message@to.subflowStateId}}","$invalid":false,"typeOfStateId":"variable"},"isAiGenerated":false,"$tags":[],"id":"b7598244-4148-498b-a4a7-6723cf33edd4","root":false,"$title":"Go to subflowStateId","$position":{"top":"119px","left":"874px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c0ac19e8-6de3-473c-97b2-aa157140c54d":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"46374437-ffbb-4b25-8962-fbd682f00d9f","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"e9ef4b64-81d0-424d-b945-044702535c38","typeOfStateId":"state","$connId":"con_18","$id":"423e953d-99b8-4c2d-9d54-68bb6336e5cf","conditions":[{"source":"context","comparison":"notEquals","values":["null"],"variable":"entrypoint@matchContent.content"}],"$invalid":false},{"stateId":"548b7557-3b9f-4cbb-b98e-d7b132864d67","typeOfStateId":"state","$connId":"con_23","$id":"ddec39fa-bbdd-49f2-b476-096187871fa4","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"$invalid":false,"typeOfStateId":"state","stateId":"1cfaf1d7-a23d-4356-a858-178830d2a3ab"},"isAiGenerated":false,"$tags":[],"id":"c0ac19e8-6de3-473c-97b2-aa157140c54d","root":false,"$title":"Has presentation content?","$position":{"top":"265px","left":"644px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true},"e9ef4b64-81d0-424d-b945-044702535c38":{"$contentActions":[{"action":{"$id":"4385b461-0a14-4efa-977b-cb8b62109400","$typeOfContent":"media","type":"SendMessage","settings":{"id":"d12ac946-dbab-40cd-93f1-0cb740f6905b","type":"application/vnd.lime.media-link+json","content":{"title":"","text":"{{description}}","type":"image/jpeg","uri":"{{image}}","aspectRatio":"1:1"},"metadata":{}},"$cardContent":{"document":{"id":"d12ac946-dbab-40cd-93f1-0cb740f6905b","type":"application/vnd.lime.media-link+json","content":{"title":"","text":"{{description}}","type":"image/jpeg","uri":"{{image}}","aspectRatio":"1:1"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:4326"},{"input":{"bypass":true,"$cardContent":{"document":{"id":"f0d30cb1-c1a5-4eb2-8936-f33283079382","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:4327"},{"action":{"$id":"75eacfd2-643f-4b38-9a84-b4d3d8bf4ee2","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"2be29054-a996-4b6f-b23c-7c4253e6dbdb","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"3000"},"metadata":{"#stateName":"{{state.name}}","#stateId":"{{state.id}}","#messageId":"{{input.message@id}}","#previousStateId":"{{state.previous.id}}","#previousStateName":"{{state.previous.name}}"}},"$cardContent":{"document":{"id":"2be29054-a996-4b6f-b23c-7c4253e6dbdb","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"3000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:4328"}],"$conditionOutputs":[{"typeOfStateId":"state","$connId":"con_28","$id":"7d187994-6079-4408-a1de-3a1b5fb92578","conditions":[{"source":"input","comparison":"exists","values":[],"$$hashKey":"object:4350"}],"$invalid":false,"stateId":"548b7557-3b9f-4cbb-b98e-d7b132864d67","$$hashKey":"object:4340"}],"$enteringCustomActions":[{"$id":"00772590-062c-4539-b97a-833cebc3c362","$typeOfContent":"","type":"ExecuteScript","$title":"SET image","$invalid":false,"settings":{"function":"run","source":"function run(entrypoint) {\n\ttry {\n\t\tentrypoint = JSON.parse(entrypoint);\n\t\t\n\t\treturn entrypoint.matchContent.content.image;\n\t}\n\tcatch(e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["entrypoint"],"outputVariable":"image","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"8fe58bf7-c683-4ede-a6b5-b059b387ded8","$typeOfContent":"","type":"ExecuteScript","$title":"SET description","$invalid":false,"settings":{"function":"run","source":"function run(entrypoint) {\n\ttry {\n\t\tentrypoint = JSON.parse(entrypoint);\n\t\t\n\t\treturn entrypoint.matchContent.content.description;\n\t}\n\tcatch(e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["entrypoint"],"outputVariable":"description","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"$invalid":false,"typeOfStateId":"state","stateId":"1cfaf1d7-a23d-4356-a858-178830d2a3ab"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-54e386b0-4b5a-4b5d-8efe-6039b95d59a3","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-d887c4b0-3814-4cff-85f3-fbf90396d4c1","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"e9ef4b64-81d0-424d-b945-044702535c38","root":false,"$title":"Display Content","$position":{"top":"362px","left":"365px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true},"7afeb5fd-c426-4333-952f-187980db27dd":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"dde48632-4516-4ae0-b32e-33847ce628c1","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"5ab1c0a9-fb0e-4a33-a750-c0646ddf0d93","$typeOfContent":"","type":"ExecuteScript","$title":"SET redirect","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nfunction run(subflow, subflowIds) {\n\tsubflow = JSON.parse(subflow)\n\tsubflowIds = JSON.parse(subflowIds)\n\n\tconst origin = setOrigin({\n\t\tservice: subflow.name,\n\t\tserviceId: subflow.id,\n\t\tstateId: '{{state.id}}',\n\t\tstateName: '{{state.name}}'\n\t});\n\n\tconst destination = setDestination({\n\t\tstateId: subflowIds.Purchase\n\t})\n\n\treturn redirect(origin, destination);\n}","inputVariables":["subflow","subflowIds"],"outputVariable":"redirect","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"1cfaf1d7-a23d-4356-a858-178830d2a3ab","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-1bbf7adc-6ae9-47ca-be06-8d6393dbf1cc","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"7afeb5fd-c426-4333-952f-187980db27dd","root":false,"$title":"Website banner","$position":{"top":"622px","left":"644px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"548b7557-3b9f-4cbb-b98e-d7b132864d67":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"deb4f3d5-69d1-4978-8baf-cd08111927d6","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"7afeb5fd-c426-4333-952f-187980db27dd","typeOfStateId":"state","$connId":"con_33","$id":"7953e0b7-5cd1-4355-8300-ce971534e900","conditions":[{"source":"context","comparison":"equals","values":["Website banner"],"variable":"entrypoint@matchContent.source"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"548b7557-3b9f-4cbb-b98e-d7b132864d67","root":false,"$title":"Check entrypoint source","$position":{"top":"451.667px","left":"644px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}},"configuration":{"builder:minimumIntentScore":"0.5","builder:stateTrack":"false","builder:#localTimeZone":"E.South America Standard Time"}},{"shortName":"inactivityhandler5","flow":{"onboarding":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"8c447ece-a028-4124-aa3e-d966dfeace69","type":"text/plain","content":"User input"},"editable":false,"deletable":false,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"b7598244-4148-498b-a4a7-6723cf33edd4","typeOfStateId":"state","$connId":"con_3","$id":"bea2dc50-239c-424a-8e36-c6587e1688e4","conditions":[{"values":[],"source":"context","comparison":"exists","variable":"message@to.subflowStateId"},{"values":["default"],"source":"context","comparison":"notEquals","variable":"message@to.subflowStateId"}],"$invalid":false},{"stateId":"6f4efa2e-e49d-4ca0-b0df-00bde1cee561","conditions":[{"source":"input","comparison":"matches","values":[".*"]}],"$id":"e3e2c8fb-b377-4909-8a4a-84b18136d650","$connId":"con_8","$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"35d3d35d-626d-482d-b29c-8e46bf690317","$typeOfContent":"","type":"SetVariable","$title":"SET service","$invalid":false,"settings":{"variable":"service","value":"Inactivity"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"6f4efa2e-e49d-4ca0-b0df-00bde1cee561","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-08c1d404-19bd-45d9-ae20-d0431d131aae","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"onboarding","root":true,"$title":"Start","$position":{"top":"92px","left":"644px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fallback":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"f721da4c-1898-4b4a-aed7-817a1fec4991","type":"text/plain","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"bcee3da8-afab-413f-8ece-e1adc419bbfa","$typeOfContent":"","type":"ExecuteScript","$title":"SET redirect","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nfunction run(subflow) {\n\tsubflow = JSON.parse(subflow)\n\n\tconst origin = setOrigin({\n\t\tservice: subflow.name,\n\t\tserviceId: subflow.id,\n\t\tstateId: '{{state.previous.id}}', \n\t\tstateName: '{{state.previous.name}}'\n\t});\n\n\treturn redirect(origin);\n}","inputVariables":["subflow"],"outputVariable":"redirect","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"end","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-fac54dfa-dee6-45b9-a8d1-1da183de1677","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"fallback","$title":"Exceptions","$position":{"top":"111px","left":"2019px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"end":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a4ae7f2a-eb06-4615-90c5-8789c855fd6d","type":"text/plain","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"end","end":true,"$title":"End","$position":{"top":"1260px","left":"656.5px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"1cfaf1d7-a23d-4356-a858-178830d2a3ab":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"b20faea7-2eae-43e9-9f4a-261db2073b01","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"typeOfStateId":"state","$connId":"con_13","$id":"5f15f6e7-44c6-486e-9ba0-2ea67597de53","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false,"stateId":"end"}],"$enteringCustomActions":[{"$id":"47b3a282-0f29-408d-8c22-0f58fa5a5120","$typeOfContent":"","type":"ExecuteScript","$title":"SET subflow (disable)","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nfunction run(stateId, stateName) {\n\treturn disableSubflowMode(stateId, stateName);\n}","inputVariables":["state.id","state.name"],"outputVariable":"subflow","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"end","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-9bf9d95f-01e7-46d0-889d-8c154574b043","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"1cfaf1d7-a23d-4356-a858-178830d2a3ab","root":false,"$title":"Leave Subflow","$position":{"top":"1101.43px","left":"657.286px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true},"b7598244-4148-498b-a4a7-6723cf33edd4":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"48b64c7d-32e8-4a27-ab76-ce05e2fa9b6d","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"{{message@to.subflowStateId}}","$invalid":false,"typeOfStateId":"variable"},"isAiGenerated":false,"$tags":[],"id":"b7598244-4148-498b-a4a7-6723cf33edd4","root":false,"$title":"Go to subflowStateId","$position":{"top":"91px","left":"867px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"6f4efa2e-e49d-4ca0-b0df-00bde1cee561":{"$contentActions":[{"action":{"$id":"82ea63e5-0d49-4dc2-8f82-56df5b1a3e7d","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"d92ec30f-98db-40a8-832c-6cb7bbc56002","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"d92ec30f-98db-40a8-832c-6cb7bbc56002","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"19322051-19de-4a2a-8e5f-bc4d31d54683","$typeOfContent":"text","type":"SendMessage","settings":{"id":"71a15226-39ca-473c-94cf-77a546e3e553","type":"text/plain","content":"Oh, I noticed that you were inactive.","metadata":{}},"$cardContent":{"document":{"id":"71a15226-39ca-473c-94cf-77a546e3e553","type":"text/plain","content":"Oh, I noticed that you were inactive."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"566502e4-ac4a-4853-b81c-a43a25398c52","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"109c5936-4f9f-46bc-81ed-e14d866ca68c","typeOfStateId":"state","$connId":"con_18","$id":"81d11cc9-d8fe-4288-856b-0244b011d8b2","conditions":[{"source":"input","comparison":"matches","values":[".*"]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-14a6f3f5-fbea-422a-baf7-dc14ceace706","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"6f4efa2e-e49d-4ca0-b0df-00bde1cee561","root":false,"$title":"Inactivity Handler","$position":{"top":"240px","left":"644px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"5244c7ab-e5c4-4ed9-83b8-f4e68c5ebeb0":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"935fe7b9-292c-49dc-b9e6-a48245d25b0d","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"b7fe4226-15c3-4092-94c1-f2fbb872ab94","$typeOfContent":"","type":"ExecuteScript","$title":"SET redirect","$invalid":false,"settings":{"function":"run","source":"function run(inactivityMessage) {\n\ttry {\n\t\tinactivityMessage = JSON.parse(inactivityMessage);\n\t\treturn inactivityMessage;\n\t}\n\tcatch(e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["inactivityMessage"],"outputVariable":"redirect","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"$invalid":false,"typeOfStateId":"state","stateId":"1cfaf1d7-a23d-4356-a858-178830d2a3ab"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-566acd4d-9399-41a1-800f-110712434d16","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"5244c7ab-e5c4-4ed9-83b8-f4e68c5ebeb0","root":false,"$title":"Return to last state with inactivity","$position":{"top":"564.286px","left":"644px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true},"109c5936-4f9f-46bc-81ed-e14d866ca68c":{"$contentActions":[{"action":{"$id":"ef10b910-87ee-48d9-9a1d-11b9cdd2a2a1","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"edc56952-5c9c-4ac9-8e92-48aa9c41fa90","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"edc56952-5c9c-4ac9-8e92-48aa9c41fa90","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"43288595-41d5-4c75-aac3-0ee76ab739d7","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"{{menu@type}}","rawContent":"{{menu@content}}"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"44824da1-a541-498e-bdbe-d6cb69a5e3cb","type":"text/plain","textContent":"User input","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"typeOfStateId":"state","$connId":"con_23","$id":"84cb11bc-1e7f-46ef-963d-ab08e4fc0c08","conditions":[{"source":"context","comparison":"equals","values":["Continue"],"variable":"userInput@selection"}],"$invalid":false,"stateId":"5244c7ab-e5c4-4ed9-83b8-f4e68c5ebeb0"},{"stateId":"a2ade3ea-42a3-4019-bcfe-f7ea30e32016","typeOfStateId":"state","$connId":"con_28","$id":"9940ff1c-5842-4a86-90df-74987938fd47","conditions":[{"source":"context","comparison":"equals","values":["End conversation"],"variable":"userInput@selection"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"3e8c2c38-a205-471a-8394-2640e1c510e6","$typeOfContent":"","type":"ExecuteScript","$title":"SET menu","$invalid":false,"settings":{"function":"run","source":"{{components}}\n\nfunction run() {\n\treturn buildQuickReply({\n\t\tchannel: '{{contact.source}}',\n\t\ttext: 'What do you like to do?',\n\t\toptions: [\n\t\t\t'Continue',\n\t\t\t'End conversation'\n\t\t]\n\t})\n}","inputVariables":[],"outputVariable":"menu","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"470ef7a3-1bbf-4d32-9ebc-bde3a1cfb9f7","$typeOfContent":"","type":"ExecuteScript","$title":"SET userInput","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nfunction run(input) {\n\treturn processUserInput(input, {\n\t\t\"^(1)$|^(continue)$\": \"Continue\",\n\t\t\"^(2)$|^(end|quit)\\\\s*conversation$\": \"End conversation\"\n\t});\n}","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-0d3e706c-cf55-4646-8b5c-95ca4aa4de28","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-d3bc9edc-ff2a-440e-a99c-6a7b62dab321","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-e77e5ae1-c20e-4957-bae9-9d2c2efcaa3c","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"109c5936-4f9f-46bc-81ed-e14d866ca68c","root":false,"$title":"Inactivity menu","$position":{"top":"402.429px","left":"644.286px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true},"a2ade3ea-42a3-4019-bcfe-f7ea30e32016":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"ede86c4e-a2e3-4e48-91ee-0d4b0ded66fb","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:14629"}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"c7c6557c-8193-4bd0-b541-17d5941aaa80","$typeOfContent":"","type":"ExecuteScript","$title":"SET redirect","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nfunction run(service, subflowIds) {\n\tsubflowIds = JSON.parse(subflowIds);\n\n\tconst origin = setOrigin({\n\t\tservice: service,\n\t\tstateId: '{{state.id}}',\n\t\tstateName: '{{state.name}}'\n\t});\n\n\tconst destination = setDestination({\n\t\tstateId: subflowIds.Finalization\n\t})\n\n\treturn redirect(origin, destination);\n}","inputVariables":["service","subflowIds"],"outputVariable":"redirect","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"$invalid":false,"typeOfStateId":"state","stateId":"1cfaf1d7-a23d-4356-a858-178830d2a3ab"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-ea956fa1-8b66-4752-ab70-49f602007feb","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"a2ade3ea-42a3-4019-bcfe-f7ea30e32016","root":false,"$title":"Inactivity Go to Finalization","$position":{"top":"390px","left":"416px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true}},"configuration":{"builder:minimumIntentScore":"0.5","builder:stateTrack":"false","builder:#localTimeZone":"E.South America Standard Time"}},{"shortName":"prefinalization1","flow":{"onboarding":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"8c447ece-a028-4124-aa3e-d966dfeace69","type":"text/plain","content":"User input"},"editable":false,"deletable":false,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"b7598244-4148-498b-a4a7-6723cf33edd4","typeOfStateId":"state","$connId":"con_3","$id":"bea2dc50-239c-424a-8e36-c6587e1688e4","conditions":[{"values":[],"source":"context","comparison":"exists","variable":"message@to.subflowStateId"},{"values":["default"],"source":"context","comparison":"notEquals","variable":"message@to.subflowStateId"}],"$invalid":false},{"stateId":"18a5764d-40ee-4fb7-ada7-9109c80c6c7e","conditions":[{"source":"input","comparison":"matches","values":[".*"]}],"$id":"e3e2c8fb-b377-4909-8a4a-84b18136d650","$connId":"con_8","$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"d4ff6188-92c7-44d3-ad30-1767d8dbd444","$typeOfContent":"","type":"TrackEvent","$title":"Service origem","$invalid":false,"settings":{"extras":{},"category":"{{subflow@name}} origem","action":"{{origin}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-ffbbcbc4-0e78-4cea-bba3-4b3d89575c44","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"onboarding","root":true,"$title":"Start","$position":{"top":"82px","left":"644px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fallback":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"f721da4c-1898-4b4a-aed7-817a1fec4991","type":"text/plain","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"8d4d2cfb-da21-4d9c-879a-807e9dc666ac","$typeOfContent":"","type":"ExecuteScript","$title":"SET redirect","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nfunction run(subflow) {\n\tsubflow = JSON.parse(subflow)\n\n\tconst origin = setOrigin({\n\t\tservice: subflow.name,\n\t\tserviceId: subflow.id,\n\t\tstateId: '{{state.previous.id}}', \n\t\tstateName: '{{state.previous.name}}'\n\t});\n\n\treturn redirect(origin);\n}","inputVariables":["subflow"],"outputVariable":"redirect","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"end","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-7db77a67-c57b-405d-9358-fdb8bbaf53a4","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"fallback","$title":"Exceptions","$position":{"top":"79px","left":"1530px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"end":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a4ae7f2a-eb06-4615-90c5-8789c855fd6d","type":"text/plain","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"end","end":true,"$title":"End","$position":{"top":"229.714px","left":"1764px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"1cfaf1d7-a23d-4356-a858-178830d2a3ab":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"b20faea7-2eae-43e9-9f4a-261db2073b01","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"typeOfStateId":"state","$connId":"con_13","$id":"5f15f6e7-44c6-486e-9ba0-2ea67597de53","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false,"stateId":"end"}],"$enteringCustomActions":[{"$id":"47b3a282-0f29-408d-8c22-0f58fa5a5120","$typeOfContent":"","type":"ExecuteScript","$title":"SET subflow (disable)","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nfunction run(stateId, stateName) {\n\treturn disableSubflowMode(stateId, stateName);\n}","inputVariables":["state.id","state.name"],"outputVariable":"subflow","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"9cba9996-dfa9-4935-8380-5560aa93e715","$typeOfContent":"","type":"ExecuteScript","$title":"SET redirect","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nfunction run(subflow) {\n\tsubflow = JSON.parse(subflow)\n\n\tconst origin = setOrigin({\n\t\tservice: subflow.name,\n\t\tserviceId: subflow.id, \n\t\tstateId: '{{state.previous.id}}', \n\t\tstateName: '{{state.previous.name}}'\n\t});\n\n\treturn redirect(origin);\n}","inputVariables":["subflow"],"outputVariable":"redirect","LocalTimeZoneEnabled":false},"conditions":[{"values":["default"],"source":"context","comparison":"equals","variable":"redirect"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"end","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-0a8199f6-c98a-477b-ab89-b64d1611b9af","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"1cfaf1d7-a23d-4356-a858-178830d2a3ab","root":false,"$title":"Leave Subflow","$position":{"top":"78px","left":"1764px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true},"b7598244-4148-498b-a4a7-6723cf33edd4":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"48b64c7d-32e8-4a27-ab76-ce05e2fa9b6d","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"{{message@to.subflowStateId}}","$invalid":false,"typeOfStateId":"variable"},"isAiGenerated":false,"$tags":[],"id":"b7598244-4148-498b-a4a7-6723cf33edd4","root":false,"$title":"Go to subflowStateId","$position":{"top":"81px","left":"875px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"18a5764d-40ee-4fb7-ada7-9109c80c6c7e":{"$contentActions":[{"action":{"$id":"e165e080-5def-47f9-9674-2d5e67a9c4ed","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"36c77e08-6068-4e47-82c4-c9da79054794","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"36c77e08-6068-4e47-82c4-c9da79054794","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"7fd5aabc-0110-4915-96d1-6c1ee70c5f38","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"{{menu@type}}","rawContent":"{{menu@content}}"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"84dc9e73-52a0-48c3-9cff-a1b4a795c4b0","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"06a6404d-1c0b-44bf-b9bd-07422ffbbf0a","typeOfStateId":"state","$connId":"con_18","$id":"b9f57ca9-4795-4667-85f7-0a2d3f47fbe6","conditions":[{"source":"context","comparison":"equals","values":["No"],"variable":"userInput@selection"}],"$invalid":false},{"stateId":"38b73841-057c-4193-b685-0300983d9c70","typeOfStateId":"state","$connId":"con_23","$id":"d64f6802-1551-470d-a8f4-df6efa881ed7","conditions":[{"source":"context","comparison":"equals","values":["Yes"],"variable":"userInput@selection"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"7480b3c6-226a-4a2c-9dcb-fe0931afe0e2","$typeOfContent":"","type":"ExecuteScript","$title":"SET menu","$invalid":false,"settings":{"function":"run","source":"{{components}}\n\nfunction run() {\n\treturn buildQuickReply({\n\t\ttext: 'Can I help you with something more?',\n\t\toptions: [ 'Yes', 'No' ]\n\t})\n}","inputVariables":[],"outputVariable":"menu","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"1bd7d56c-d09a-45cc-91c0-86ff1737c5cc","$typeOfContent":"","type":"ExecuteScript","$title":"SET userInput","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nfunction run(input) {\n\treturn processUserInput(input, {\n\t\t'^(1)$|^(yes|sure)$': 'Yes',\n\t\t'^(2)$|^(no)$': 'No'\n\t})\n}","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"73e36f1a-7c0a-48bd-9709-c52e046f7de6","$typeOfContent":"","type":"ExecuteScript","$title":"SET error","$invalid":false,"settings":{"function":"run","source":"function run() {\n\treturn {\n\t\t'id': 'QuickReplyError', \n\t\t'hasAIValidation': false,\n\t\t'hasSmalltalksValidation': true,\n\t\t'hasGlobalRegexValidation': true,\n\t\t'customErrorMessage': 'default'\n\t} \n}","inputVariables":[],"outputVariable":"error","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-15c93c8c-53ce-46bd-b871-b06c58507f7d","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-6e65cd3d-66d5-4071-9e3d-1215047d1b0d","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-0771d6f8-0768-4917-abed-f65f15e35833","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"18a5764d-40ee-4fb7-ada7-9109c80c6c7e","root":false,"$title":"Need more help?","$position":{"top":"245px","left":"644px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"06a6404d-1c0b-44bf-b9bd-07422ffbbf0a":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"5dca3ae1-360e-4fd3-85a7-adb96fc50d84","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:2252"}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"43bd6d36-9f9d-4db7-9793-53f9e14588dd","$typeOfContent":"","type":"ExecuteScript","$title":"SET redirect","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nfunction run(subflow, subflowIds) {\n\tsubflow = JSON.parse(subflow)\n\tsubflowIds = JSON.parse(subflowIds);\n\n\tconst origin = setOrigin({\n\t\tservice: subflow.name,\n\t\tseviceId: subflow.id,\n\t\tstateId: '{{state.id}}',\n\t\tstateName: '{{state.name}}'\n\t});\n\n\tconst destination = setDestination({\n\t\tstateId: subflowIds.Finalization\n\t})\n\n\treturn redirect(origin, destination);\n}","inputVariables":["subflow","subflowIds"],"outputVariable":"redirect","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"1cfaf1d7-a23d-4356-a858-178830d2a3ab","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-dc108ded-7dd7-414f-8ce8-ba9ed4620754","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"06a6404d-1c0b-44bf-b9bd-07422ffbbf0a","root":false,"$title":"No","$position":{"top":"419px","left":"480px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"38b73841-057c-4193-b685-0300983d9c70":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"233f3e54-33a6-4955-9e6c-25ac01ba69ac","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"adf87068-4c02-4fa0-ae70-fd555d2531ca","$typeOfContent":"","type":"ExecuteScript","$title":"SET redirect","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nfunction run(subflow, subflowIds) {\n\tsubflow = JSON.parse(subflow)\n\tsubflowIds =  JSON.parse(subflowIds)\n\n\tconst origin = setOrigin({\n\t\tservice: subflow.name,\n\t\tserviceId: subflow.id,\n\t\tstateId: '{{state.previous.id}}',\n\t\tstateName: '{{state.previous.name}}'\n\t})\n\n\tconst destination = setDestination({\n\t\tstateId: subflowIds.MainMenu\n\t})\n\n\treturn redirect(origin, destination)\n}","inputVariables":["subflow","subflowIds"],"outputVariable":"redirect","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"1cfaf1d7-a23d-4356-a858-178830d2a3ab","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-67533681-5365-41b8-957f-9d57ffd15aa6","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"38b73841-057c-4193-b685-0300983d9c70","root":false,"$title":"Yes","$position":{"top":"423px","left":"814px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}},"configuration":{"builder:minimumIntentScore":"0.5","builder:stateTrack":"false","builder:#localTimeZone":"E.South America Standard Time"}},{"shortName":"onboarding7","flow":{"onboarding":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"8c447ece-a028-4124-aa3e-d966dfeace69","type":"text/plain","content":"User input"},"editable":false,"deletable":false,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"b7598244-4148-498b-a4a7-6723cf33edd4","typeOfStateId":"state","$connId":"con_3","$id":"bea2dc50-239c-424a-8e36-c6587e1688e4","conditions":[{"values":[],"source":"context","comparison":"exists","variable":"message@to.subflowStateId"},{"values":["default"],"source":"context","comparison":"notEquals","variable":"message@to.subflowStateId"}],"$invalid":false},{"stateId":"bab7849b-ac7d-42dc-bf01-2c52cb705459","typeOfStateId":"state","$connId":"con_8","$id":"5db33892-d0ba-4419-a881-5ca1795a4d23","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"64b79f8f-8fdf-4c80-adc3-fedc632cf54c","$typeOfContent":"","type":"TrackEvent","$title":"Service origem","$invalid":false,"settings":{"extras":{},"category":"{{subflow@name}} origem","action":"{{origin}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-94bd067f-d3af-414e-a070-fb39c5613886","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"onboarding","root":true,"$title":"Start","$position":{"top":"145px","left":"674px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fallback":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"f721da4c-1898-4b4a-aed7-817a1fec4991","type":"text/plain","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"369b2cbe-a364-4144-997a-974de88da360","$typeOfContent":"","type":"ExecuteScript","$title":"SET redirect","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nfunction run(subflow) {\n\tsubflow = JSON.parse(subflow)\n\n\tconst origin = setOrigin({\n\t\tservice: subflow.name,\n\t\tserviceId: subflow.id,\n\t\tstateId: '{{state.previous.id}}', \n\t\tstateName: '{{state.previous.name}}'\n\t});\n\n\treturn redirect(origin);\n}","inputVariables":["subflow"],"outputVariable":"redirect","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"end","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-c7dfa837-4b83-4afb-a117-8ab3e9e3367e","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"fallback","$title":"Exceptions","$position":{"top":"148px","left":"1590px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"end":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a4ae7f2a-eb06-4615-90c5-8789c855fd6d","type":"text/plain","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"end","end":true,"$title":"End","$position":{"top":"303.778px","left":"1799.56px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"1cfaf1d7-a23d-4356-a858-178830d2a3ab":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"b20faea7-2eae-43e9-9f4a-261db2073b01","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"typeOfStateId":"state","$connId":"con_13","$id":"5f15f6e7-44c6-486e-9ba0-2ea67597de53","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false,"stateId":"end"}],"$enteringCustomActions":[{"$id":"47b3a282-0f29-408d-8c22-0f58fa5a5120","$typeOfContent":"","type":"ExecuteScript","$title":"SET subflow (disable)","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nfunction run(stateId, stateName) {\n\treturn disableSubflowMode(stateId, stateName);\n}","inputVariables":["state.id","state.name"],"outputVariable":"subflow","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"483e3d9e-688c-4627-8863-fa055ffacca7","$typeOfContent":"","type":"ExecuteScript","$title":"SET redirect","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nfunction run(subflow) {\n\tsubflow = JSON.parse(subflow)\n\n\tconst origin = setOrigin({\n\t\tservice: subflow.name,\n\t\tserviceId: subflow.id, \n\t\tstateId: '{{state.previous.id}}', \n\t\tstateName: '{{state.previous.name}}'\n\t});\n\n\treturn redirect(origin);\n}","inputVariables":["subflow"],"outputVariable":"redirect","LocalTimeZoneEnabled":false},"conditions":[{"values":["default"],"source":"context","comparison":"equals","variable":"redirect"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"end","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-d14ccff2-24b6-4f71-a76f-0793494b0b48","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"1cfaf1d7-a23d-4356-a858-178830d2a3ab","root":false,"$title":"Leave Subflow","$position":{"top":"147px","left":"1800px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true},"b7598244-4148-498b-a4a7-6723cf33edd4":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"48b64c7d-32e8-4a27-ab76-ce05e2fa9b6d","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"{{message@to.subflowStateId}}","$invalid":false,"typeOfStateId":"variable"},"isAiGenerated":false,"$tags":[],"id":"b7598244-4148-498b-a4a7-6723cf33edd4","root":false,"$title":"Go to subflowStateId","$position":{"top":"144px","left":"922px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"bab7849b-ac7d-42dc-bf01-2c52cb705459":{"$contentActions":[{"action":{"$id":"8cf46a72-94cf-448d-b8d7-949f664873b6","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"cbe8394d-2195-49fa-a528-836021cb9edc","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"cbe8394d-2195-49fa-a528-836021cb9edc","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"288009eb-e503-4932-a236-f04c79a73dca","$typeOfContent":"text","type":"SendMessage","settings":{"id":"4feddcac-3997-41d7-b0d0-e0fade043853","type":"text/plain","content":"Hi! 👋 Good to see you here.","metadata":{}},"$cardContent":{"document":{"id":"4feddcac-3997-41d7-b0d0-e0fade043853","type":"text/plain","content":"Hi! 👋 Good to see you here."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"0928e239-8774-4205-977e-627df77c8e41","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"1cfaf1d7-a23d-4356-a858-178830d2a3ab","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-fefa57c6-ed78-4c2a-8459-d8520e01d9ee","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"bab7849b-ac7d-42dc-bf01-2c52cb705459","root":false,"$title":"Greeting","$position":{"top":"303.444px","left":"674px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true}},"configuration":{"builder:minimumIntentScore":"0.5","builder:stateTrack":"false","builder:#localTimeZone":"E.South America Standard Time"}},{"shortName":"mainmenu4","flow":{"onboarding":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"8c447ece-a028-4124-aa3e-d966dfeace69","type":"text/plain","content":"User input"},"editable":false,"deletable":false,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"b7598244-4148-498b-a4a7-6723cf33edd4","typeOfStateId":"state","$connId":"con_3","$id":"bea2dc50-239c-424a-8e36-c6587e1688e4","conditions":[{"values":[],"source":"context","comparison":"exists","variable":"message@to.subflowStateId"},{"values":["default"],"source":"context","comparison":"notEquals","variable":"message@to.subflowStateId"}],"$invalid":false},{"stateId":"bab7849b-ac7d-42dc-bf01-2c52cb705459","typeOfStateId":"state","$connId":"con_8","$id":"5db33892-d0ba-4419-a881-5ca1795a4d23","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"64b79f8f-8fdf-4c80-adc3-fedc632cf54c","$typeOfContent":"","type":"TrackEvent","$title":"Service origem","$invalid":false,"settings":{"extras":{},"category":"{{subflow@name}} origem","action":"{{origin}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-ec548e2f-7821-4fa0-a81c-bf3d01d6ebcb","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"onboarding","root":true,"$title":"Start","$position":{"top":"145px","left":"674px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fallback":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"f721da4c-1898-4b4a-aed7-817a1fec4991","type":"text/plain","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"4375548b-c05c-4d8a-91db-24ae293d3d8c","$typeOfContent":"","type":"ExecuteScript","$title":"SET redirect","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nfunction run(subflow) {\n\tsubflow = JSON.parse(subflow)\n\n\tconst origin = setOrigin({\n\t\tservice: subflow.name,\n\t\tserviceId: subflow.id,\n\t\tstateId: '{{state.previous.id}}', \n\t\tstateName: '{{state.previous.name}}'\n\t});\n\n\treturn redirect(origin);\n}","inputVariables":["subflow"],"outputVariable":"redirect","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"end","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-d3dcc138-04ae-4595-9abb-81b64cd088ec","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"fallback","$title":"Exceptions","$position":{"top":"154px","left":"1613px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"end":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a4ae7f2a-eb06-4615-90c5-8789c855fd6d","type":"text/plain","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"end","end":true,"$title":"End","$position":{"top":"306px","left":"1814px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"1cfaf1d7-a23d-4356-a858-178830d2a3ab":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"b20faea7-2eae-43e9-9f4a-261db2073b01","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"typeOfStateId":"state","$connId":"con_13","$id":"5f15f6e7-44c6-486e-9ba0-2ea67597de53","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false,"stateId":"end"}],"$enteringCustomActions":[{"$id":"47b3a282-0f29-408d-8c22-0f58fa5a5120","$typeOfContent":"","type":"ExecuteScript","$title":"SET subflow (disable)","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nfunction run(stateId, stateName) {\n\treturn disableSubflowMode(stateId, stateName);\n}","inputVariables":["state.id","state.name"],"outputVariable":"subflow","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"eeaa2f14-bc6e-4ae1-bf8b-b58dcef80ce8","$typeOfContent":"","type":"ExecuteScript","$title":"SET redirect","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nfunction run(subflow) {\n\tsubflow = JSON.parse(subflow)\n\n\tconst origin = setOrigin({\n\t\tservice: subflow.name,\n\t\tserviceId: subflow.id, \n\t\tstateId: '{{state.previous.id}}', \n\t\tstateName: '{{state.previous.name}}'\n\t});\n\n\treturn redirect(origin);\n}","inputVariables":["subflow"],"outputVariable":"redirect","LocalTimeZoneEnabled":false},"conditions":[{"values":["default"],"source":"context","comparison":"equals","variable":"redirect"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"end","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-365126d6-c5ec-4986-baa8-2942e8f5e0dd","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"1cfaf1d7-a23d-4356-a858-178830d2a3ab","root":false,"$title":"Leave Subflow","$position":{"top":"152px","left":"1814px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true},"b7598244-4148-498b-a4a7-6723cf33edd4":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"48b64c7d-32e8-4a27-ab76-ce05e2fa9b6d","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"{{message@to.subflowStateId}}","$invalid":false,"typeOfStateId":"variable"},"isAiGenerated":false,"$tags":[],"id":"b7598244-4148-498b-a4a7-6723cf33edd4","root":false,"$title":"Go to subflowStateId","$position":{"top":"144px","left":"922px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"bab7849b-ac7d-42dc-bf01-2c52cb705459":{"$contentActions":[{"action":{"$id":"e8db4133-df20-402c-8e2e-46cd522eda71","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"ed2b80ff-4bb5-4011-b967-84264aada5ff","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"ed2b80ff-4bb5-4011-b967-84264aada5ff","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:3983"},{"action":{"$id":"c04aab14-89d8-4e66-9bfb-ef5f4adf7b6f","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"{{menu@type}}","rawContent":"{{menu@content}}"}},"$invalid":false,"$$hashKey":"object:3984"},{"input":{"bypass":false,"$cardContent":{"document":{"id":"0928e239-8774-4205-977e-627df77c8e41","type":"text/plain","textContent":"User input","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:1"},"$invalid":false,"$$hashKey":"object:3985"}],"$conditionOutputs":[{"stateId":"062588db-3c77-4459-8199-98bab8e7c8c4","typeOfStateId":"state","$connId":"con_18","$id":"193d67bc-bef8-4d91-83b7-7d57bd6a76b5","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"userInput@isValid","$$hashKey":"object:4007"}],"$invalid":false,"$$hashKey":"object:3993"}],"$enteringCustomActions":[{"$id":"0d65960e-08e8-40d1-be37-15c5234b8ad1","$typeOfContent":"","type":"ExecuteScript","$title":"SET menu","$invalid":false,"settings":{"function":"run","source":"{{components}}\n\nfunction run() {\n\treturn buildMenuList({\n\t\ttext: 'Please, select an option:',\n\t\toptions: [\n\t\t\t{\n\t\t\t\tsection: 'default',\n\t\t\t\trows: [\n\t\t\t\t\t{ title: 'Eletronics', description: 'default' },\n\t\t\t\t\t{ title: 'Pet supplies', description: 'default' },\n\t\t\t\t\t{ title: 'Movies & Television', description: 'default' }\n\t\t\t\t]\n\t\t\t}\n\t\t]\n\t})\n}","inputVariables":[],"outputVariable":"menu","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"d43e0c4e-5e06-4b92-b8ae-a7b1daffc2fd","$typeOfContent":"","type":"ExecuteScript","$title":"SET userInput","$invalid":false,"settings":{"function":"run","source":"{{globalScripts}}\n\nfunction run(input) {\n\treturn processUserInput(input, {\n\t\t'^(1)$|^eletronics()$': 'Eletronics',\n\t\t'^(2)$|^(pet\\\\s*supplies)$': 'Pet Supplies',\n\t\t'^(3)$|^(movies\\\\s*&\\\\s*television)$': 'Movies & Television'\n\t});\n}","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"b43332a0-8c84-4e72-bd41-ac19e7516c53","$typeOfContent":"","type":"ExecuteScript","$title":"SET error","$invalid":false,"settings":{"function":"run","source":"function run() {\n  return {\n    'id': 'MenuListError',\n    'hasAIValidation': false,\n    'hasSmalltalksValidation': true,\n    'hasGlobalRegexValidation': true,\n    'customErrorMessage': 'default' \n  } \n}","inputVariables":[],"outputVariable":"error","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-3e713445-9fbf-479d-88f8-470107896985","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-55cea3a2-c1c5-4c76-ba36-9467de7b3209","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-d06c8402-5671-4b21-a65b-a18e0dc23f02","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"bab7849b-ac7d-42dc-bf01-2c52cb705459","root":false,"$title":"Select a category","$position":{"top":"362px","left":"674px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true},"062588db-3c77-4459-8199-98bab8e7c8c4":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"26a1b111-7162-4f86-9f5a-3a1dd4ee2949","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"1768d2dd-0508-469d-b23b-e99c615c7339","$typeOfContent":"","type":"SetVariable","$title":"SET selectedOption","$invalid":false,"settings":{"variable":"selectedOption","value":"{{userInput@selection}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"1cfaf1d7-a23d-4356-a858-178830d2a3ab","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-a3fe155d-56c8-43ec-9c31-7d934cfd1497","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"062588db-3c77-4459-8199-98bab8e7c8c4","root":false,"$title":"Save answer","$position":{"top":"550px","left":"674px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}},"configuration":{"builder:minimumIntentScore":"0.5","builder:stateTrack":"false","builder:#localTimeZone":"E.South America Standard Time"}}]}